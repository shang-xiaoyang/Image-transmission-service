"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var e,a=t(require("axios")),n=require("stream"),o=t(require("lodash/get")),i=t(require("lodash/set")),c=t(require("qs")),s=t(require("fs")),r=t(require("fs/promises")),u=require("util"),l=t(require("debug")),p=require("tos-crc64-js"),d=t(require("crypto-js/md5")),h=t(require("crypto-js/enc-base64")),f=t(require("crypto-js/enc-hex")),m=t(require("crypto-js/enc-utf8")),y=t(require("crypto")),g=t(require("path")),x=t(require("lodash/cloneDeep")),k=t(require("http")),b=t(require("https")),T=t(require("os"));class v extends Error{constructor(t){const{data:e}=t;super(e.Message),this.code=void 0,this.data=void 0,this.statusCode=void 0,this.headers=void 0,this.requestId=void 0,this.id2=void 0,this.ec=void 0,Object.setPrototypeOf(this,v.prototype),this.data=e,this.code=e.Code,this.statusCode=t.status,this.headers=t.headers,this.requestId=t.headers["x-tos-request-id"]||t.data.RequestId,this.id2=t.headers["x-tos-id-2"],this.ec=t.headers["x-tos-ec"]||t.data.EC}}(e=exports.TosServerCode||(exports.TosServerCode={})).NoSuchBucket="NoSuchBucket",e.NoSuchKey="NoSuchKey",e.AccessDenied="AccessDenied",e.MalformedAcl="MalformedAclError",e.UnexpectedContent="UnexpectedContent",e.InvalidRequest="InvalidRequest",e.MissingSecurityHeader="MissingSecurityHeader",e.InvalidArgument="InvalidArgument",e.EntityTooSmall="EntityTooSmall",e.InvalidBucketName="InvalidBucketName",e.BucketNotEmpty="BucketNotEmpty",e.TooManyBuckets="TooManyBuckets",e.BucketAlreadyExists="BucketAlreadyExists",e.MalformedBody="MalformedBody",e.NoSuchLifecycleConfiguration="NoSuchLifecycleConfiguration",e.ReplicationConfigurationNotFound="ReplicationConfigurationNotFoundError",e.InvalidLocationConstraint="InvalidLocationConstraint",e.AuthorizationQueryParametersError="AuthorizationQueryParametersError",e.RequestTimeTooSkewed="RequestTimeTooSkewed",e.SignatureDoesNotMatch="SignatureDoesNotMatch",e.RequestedRangeNotSatisfiable="Requested Range Not Satisfiable",e.PreconditionFailed="PreconditionFailed",e.BadDigest="BadDigest",e.InvalidDigest="InvalidDigest",e.EntityTooLarge="EntityTooLarge",e.UnImplemented="UnImplemented",e.MethodNotAllowed="MethodNotAllowed",e.InvalidAccessKeyId="InvalidAccessKeyId",e.InvalidSecurityToken="InvalidSecurityToken",e.ContentSHA256Mismatch="ContentSHA256Mismatch",e.ExceedQPSLimit="ExceedQPSLimit",e.ExceedRateLimit="ExceedRateLimit",e.NoSuchCORSConfiguration="NoSuchCORSConfiguration",e.NoSuchMirrorConfiguration="NoSuchMirrorConfiguration",e.NoSuchWebsiteConfiguration="NoSuchWebsiteConfiguration",e.MissingRequestBody="MissingRequestBodyError",e.BucketAlreadyOwnedByYou="BucketAlreadyOwnedByYou",e.NoSuchBucketPolicy="NoSuchBucketPolicy",e.PolicyTooLarge="PolicyTooLarge",e.MalformedPolicy="MalformedPolicy",e.InvalidKey="InvalidKey",e.MirrorFailed="MirrorFailed",e.Timeout="Timeout",e.OffsetNotMatched="OffsetNotMatched",e.NotAppendable="NotAppendable",e.ContextCanceled="ContextCanceled",e.InternalError="InternalError",e.TooManyRequests="TooManyRequests",e.TimeOut="TimeOut",e.ConcurrencyUpdateObjectLimit="ConcurrencyUpdateObjectLimit",e.DuplicateUpload="DuplicateUpload",e.DuplicateObject="DuplicateObject",e.InvalidVersionId="InvalidVersionId",e.StorageClassNotMatch="StorageClassNotMatch",e.UploadStatusNotUploading="UploadStatusNotUploading",e.PartSizeNotMatch="PartSizeNotMatch",e.NoUploadPart="NoUploadPart",e.PartsLenInvalid="PartsLenInvalid",e.PartsIdxSmall="PartsIdxSmall",e.PartSizeSmall="PartSizeSmall",e.PrefixNotNextKeyPrefix="PrefixNotNextKeyPrefix",e.InvalidPart="InvalidPart",e.InvalidPartOffset="InvalidPartOffset",e.MismatchObject="MismatchObject",e.UploadStatusMismatch="UploadStatusMismatch",e.CompletingStatusNoExpiration="CompletingStatusNoExpiration",e.Found="Found",e.InvalidRedirectLocation="InvalidRedirectLocation";class w extends Error{constructor(t){super(t),Object.setPrototypeOf(this,w.prototype)}}class S extends Error{constructor(t){super(t),Object.setPrototypeOf(this,S.prototype)}}const E=s.createWriteStream,C=s.createReadStream,B=u.promisify(s.rename),P=u.promisify(s.stat),I=u.promisify(s.writeFile),R=u.promisify(s.unlink),A=u.promisify(s.readFile),D=async t=>{try{await r.access(t)}catch(e){await r.mkdir(t,{recursive:!0})}},O=l("TOS"),M=t=>e=>{if(null==t||"object"!=typeof t)return;const a=o(t,e);Array.isArray(a)||i(t,e,null==a?[]:[a])},_=t=>{const e=a=>Array.isArray(a)?a.map(t=>e(t)):"string"==typeof a?t(a):"object"==typeof a&&null!=a?Object.keys(a).reduce((t,n)=>(t[e(n)]=a[n],t),{}):a;return e},j=_(t=>t.replace(/[A-Z]/g,"-$&").toLowerCase()),N=_(t=>t[0].toUpperCase()+t.slice(1)),L=t=>{const e=[];return Object.keys(t).sort().forEach(a=>{e.push(`${encodeURIComponent(a)}=${encodeURIComponent(t[a])}`)}),e.join("&")},U=t=>{const e=t||{},a={};Object.keys(e).forEach(t=>{null!=e[t]&&(a[t]=e[t])});const n={};return Object.keys(a).forEach(t=>{const e=t.toLowerCase();n[e]=a[t]}),n},z=t=>("string"==typeof t&&(t={url:t}),t);async function F(t){try{return[null,await t]}catch(t){return[t,null]}}function G(t){return"undefined"!=typeof Blob&&t instanceof Blob}function K(t){return"undefined"!=typeof Buffer&&t instanceof Buffer}function q(t){return t instanceof n.Readable}function $(t){return t?Object.keys(t).map(e=>{const a=""+t[e];return`${encodeURIComponent(e)}=${encodeURIComponent(a)}`}).join("&"):""}function V(t){return t instanceof S}const H=t=>"string"==typeof t?t:t.toUTCString(),W={projectName:"x-tos-project-name",encodingType:"encoding-type",cacheControl:"cache-control",contentDisposition:"content-disposition",contentLength:"content-length",contentMD5:"content-md5",contentSHA256:"x-tos-content-sha256",contentEncoding:"content-encoding",contentLanguage:"content-language",contentType:"content-type",expires:["expires",t=>t.toUTCString()],range:"range",ifMatch:"if-match",ifModifiedSince:["if-modified-since",H],ifNoneMatch:"if-none-match",ifUnmodifiedSince:["if-unmodified-since",H],acl:"x-tos-acl",grantFullControl:"x-tos-grant-full-control",grantRead:"x-tos-grant-read",grantReadAcp:"x-tos-grant-read-acp",grantWrite:"x-tos-grant-write",grantWriteAcp:"x-tos-grant-write-acp",serverSideEncryption:"x-tos-server-side-encryption",serverSideDataEncryption:"x-tos-server-side-data-encryption",ssecAlgorithm:"x-tos-server-side-encryption-customer-algorithm",ssecKey:"x-tos-server-side-encryption-customer-key",ssecKeyMD5:"x-tos-server-side-encryption-customer-key-md5",copySourceRange:"x-tos-copy-source-range",copySourceIfMatch:"x-tos-copy-source-if-match",copySourceIfModifiedSince:["x-tos-copy-source-if-modified-since",H],copySourceIfNoneMatch:"x-tos-copy-source-if-none-match",copySourceIfUnmodifiedSince:"x-tos-copy-source-if-unmodified-since",copySourceSSECAlgorithm:"x-tos-copy-source-server-side-encryption-customer-algorithm",copySourceSSECKey:"x-tos-copy-source-server-side-encryption-customer-key",copySourceSSECKeyMD5:"x-tos-copy-source-server-side-encryption-customer-key-MD5",metadataDirective:"x-tos-metadata-directive",meta:t=>Object.keys(t).reduce((e,a)=>(e["x-tos-meta-"+a]=""+t[a],e),{}),websiteRedirectLocation:"x-tos-website-redirect-location",storageClass:"x-tos-storage-class",azRedundancy:"x-tos-az-redundancy",trafficLimit:"x-tos-traffic-limit",callback:"x-tos-callback",callbackVar:"x-tos-callback-var",allowSameActionOverlap:["x-tos-allow-same-action-overlap",t=>String(t)],symLinkTargetKey:"x-tos-symlink-target",symLinkTargetBucket:"x-tos-symlink-bucket",forbidOverwrite:"x-tos-forbid-overwrite",bucketType:"x-tos-bucket-type",recursiveMkdir:"x-tos-recursive-mkdir",tagging:"x-tos-tagging"},J={versionId:"versionId",process:"x-tos-process",saveBucket:"x-tos-save-bucket",saveObject:"x-tos-save-object",responseCacheControl:"response-cache-control",responseContentDisposition:"response-content-disposition",responseContentEncoding:"response-content-encoding",responseContentLanguage:"response-content-language",responseContentType:"response-content-type",responseExpires:["response-expires",t=>t.toUTCString()]};function Q(t,e){if(!e.length)return;const a=t.headers||{};function n(t,e){null==a[t]&&(a[t]=e)}t.headers=a,e.forEach(e=>{const a=W[e];if(!a)throw new w(`\`${e}\` isn't in keys of \`requestHeadersMap\``);const o=t[e];if(null==o)return;if("string"==typeof a)return n(a,""+o);if(Array.isArray(a))return n(a[0],a[1](o));const i=a(o);Object.entries(i).forEach(([t,e])=>{n(t,e)})})}const X=t=>c.stringify(t);function Y(t,e){return{data:t,statusCode:e.statusCode,headers:e.headers,requestId:e.requestId,id2:e.id2}}function Z(t,e){const a=e["x-tos-hash-crc64ecma"];if(null==a)return;const n="string"==typeof t?t:t.getCrc64();if(n!==a)throw new w(`validate file crc64 failed. Expect crc64 ${a}, actual crc64 ${n}. Please try again.`)}const tt=(t,e)=>t.on("error",t=>{O("bindStreamErrorHandler: ",(e||"")+" stream error:",t)});var et;!function(t){t.LastModified="last-modified",t.ContentLength="content-length",t.AcceptEncoding="accept-encoding",t.ContentEncoding="content-encoding",t.ContentMD5="content-md5",t.TosRawContentLength="x-tos-raw-content-length",t.TosTrailer="x-tos-trailer",t.TosHashCrc64ecma="x-tos-hash-crc64ecma",t.TosContentSha256="x-tos-content-sha256",t.TosDecodedContentLength="x-tos-decoded-content-length",t.TosEc="x-tos-ec",t.TosRequestId="x-tos-request-id"}(et||(et={}));const at=t=>{let e=Promise.resolve();return async()=>(e=e.then(()=>t()),e)},nt=async t=>{try{return JSON.parse(await A(t,"utf-8"))}catch(t){return void console.warn("checkpoint's content is not a valid JSON")}},ot=t=>{let e=null;return{getLastStream:()=>e,make:()=>(e&&(tt(e,"retry new stream"),it(e,new Error("retry new stream by makeRetryStreamAutoClose"))),e=t(),e)}},it=(t,e)=>{t&&"destroy"in t&&"function"==typeof t.destroy&&"destroyed"in t&&!t.destroyed&&t.destroy(e)},ct=(t,e,a)=>(tt(e,a),t.on("error",t=>it(e,t)),e.on("error",e=>it(t,e)),t.pipe(e)),st=(t,e)=>{if(!e&&t){if(t.length<3||t.length>63)throw new w("invalid bucket name, the length must be [3, 63]");if(!/^([a-z]|-|\d)+$/.test(t))throw new w("invalid bucket name, the character set is illegal");if(/^-/.test(t)||/-$/.test(t))throw new w("invalid bucket name, the bucket name can be neither starting with '-' nor ending with '-'")}};async function rt(t){t=this.normalizeObjectInput(t);const e=U(t.headers);return t.headers=e,Q(t,["encodingType","cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","serverSideEncryption","serverSideDataEncryption","meta","websiteRedirectLocation","storageClass","forbidOverwrite"]),this.setObjectContentTypeHeader(t,e),this._fetchObject(t,"POST",{uploads:""},e,"")}const ut=(t,e,a=!1)=>{let n=e;e<5242880&&(n=5242880,a&&console.warn(`partSize has been set to ${n}, because the partSize you provided is less than the minimal size of multipart`));const o=Math.ceil(t/1e4);return e<o&&(n=o,a&&console.warn(`partSize has been set to ${n}, because the partSize you provided causes the number of part excesses 10,000`)),n};async function lt(t){const{uploadId:e,...a}=t,n=await this._fetchObject(t,"GET",{uploadId:e,...j(a)},{});return M(n.data)("Parts"),n}const pt={"3gp":"video/3gpp","7z":"application/x-7z-compressed",abw:"application/x-abiword",ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",alc:"chemical/x-alchemy",amr:"audio/amr",anx:"application/annodex",apk:"application/vnd.android.package-archive",appcache:"text/cache-manifest",art:"image/x-jg",asc:"text/plain",asf:"video/x-ms-asf",aso:"chemical/x-ncbi-asn1-binary",asx:"video/x-ms-asf",atom:"application/atom+xml",atomcat:"application/atomcat+xml",atomsrv:"application/atomserv+xml",au:"audio/basic",avi:"video/x-msvideo",awb:"audio/amr-wb",axa:"audio/annodex",axv:"video/annodex",b:"chemical/x-molconn-Z",bak:"application/x-trash",bat:"application/x-msdos-program",bcpio:"application/x-bcpio",bib:"text/x-bibtex",bin:"application/octet-stream",bmp:"image/x-ms-bmp",boo:"text/x-boo",book:"application/x-maker",brf:"text/plain",bsd:"chemical/x-crossfire",c:"text/x-csrc","c++":"text/x-c++src",c3d:"chemical/x-chem3d",cab:"application/x-cab",cac:"chemical/x-cache",cache:"chemical/x-cache",cap:"application/vnd.tcpdump.pcap",cascii:"chemical/x-cactvs-binary",cat:"application/vnd.ms-pki.seccat",cbin:"chemical/x-cactvs-binary",cbr:"application/x-cbr",cbz:"application/x-cbz",cc:"text/x-c++src",cda:"application/x-cdf",cdf:"application/x-cdf",cdr:"image/x-coreldraw",cdt:"image/x-coreldrawtemplate",cdx:"chemical/x-cdx",cdy:"application/vnd.cinderella",cef:"chemical/x-cxf",cer:"chemical/x-cerius",chm:"chemical/x-chemdraw",chrt:"application/x-kchart",cif:"chemical/x-cif",class:"application/java-vm",cls:"text/x-tex",cmdf:"chemical/x-cmdf",cml:"chemical/x-cml",cod:"application/vnd.rim.cod",com:"application/x-msdos-program",cpa:"chemical/x-compass",cpio:"application/x-cpio",cpp:"text/x-c++src",cpt:"application/mac-compactpro",cr2:"image/x-canon-cr2",crl:"application/x-pkcs7-crl",crt:"application/x-x509-ca-cert",crw:"image/x-canon-crw",csd:"audio/csound",csf:"chemical/x-cache-csf",csh:"application/x-csh",csm:"chemical/x-csml",csml:"chemical/x-csml",css:"text/css",csv:"text/csv",ctab:"chemical/x-cactvs-binary",ctx:"chemical/x-ctx",cu:"application/cu-seeme",cub:"chemical/x-gaussian-cube",cxf:"chemical/x-cxf",cxx:"text/x-c++src",d:"text/x-dsrc",davmount:"application/davmount+xml",dcm:"application/dicom",dcr:"application/x-director",ddeb:"application/vnd.debian.binary-package",dif:"video/dv",diff:"text/x-diff",dir:"application/x-director",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dl:"video/dl",dll:"application/x-msdos-program",dmg:"application/x-apple-diskimage",dms:"application/x-dms",doc:"application/msword",docm:"application/vnd.ms-word.document.macroEnabled.12",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dot:"application/msword",dotm:"application/vnd.ms-word.template.macroEnabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",dv:"video/dv",dvi:"application/x-dvi",dx:"chemical/x-jcamp-dx",dxr:"application/x-director",emb:"chemical/x-embl-dl-nucleotide",embl:"chemical/x-embl-dl-nucleotide",eml:"message/rfc822",eot:"application/vnd.ms-fontobject",eps:"application/postscript",eps2:"application/postscript",eps3:"application/postscript",epsf:"application/postscript",epsi:"application/postscript",erf:"image/x-epson-erf",es:"application/ecmascript",etx:"text/x-setext",exe:"application/x-msdos-program",ez:"application/andrew-inset",fb:"application/x-maker",fbdoc:"application/x-maker",fch:"chemical/x-gaussian-checkpoint",fchk:"chemical/x-gaussian-checkpoint",fig:"application/x-xfig",flac:"audio/flac",fli:"video/fli",flv:"video/x-flv",fm:"application/x-maker",frame:"application/x-maker",frm:"application/x-maker",gal:"chemical/x-gaussian-log",gam:"chemical/x-gamess-input",gamin:"chemical/x-gamess-input",gan:"application/x-ganttproject",gau:"chemical/x-gaussian-input",gcd:"text/x-pcs-gcd",gcf:"application/x-graphing-calculator",gcg:"chemical/x-gcg8-sequence",gen:"chemical/x-genbank",gf:"application/x-tex-gf",gif:"image/gif",gjc:"chemical/x-gaussian-input",gjf:"chemical/x-gaussian-input",gl:"video/gl",gnumeric:"application/x-gnumeric",gpt:"chemical/x-mopac-graph",gsf:"application/x-font",gsm:"audio/x-gsm",gtar:"application/x-gtar",gz:"application/gzip",h:"text/x-chdr","h++":"text/x-c++hdr",hdf:"application/x-hdf",hh:"text/x-c++hdr",hin:"chemical/x-hin",hpp:"text/x-c++hdr",hqx:"application/mac-binhex40",hs:"text/x-haskell",hta:"application/hta",htc:"text/x-component",htm:"text/html",html:"text/html",hwp:"application/x-hwp",hxx:"text/x-c++hdr",ica:"application/x-ica",ice:"x-conference/x-cooltalk",ico:"image/vnd.microsoft.icon",ics:"text/calendar",icz:"text/calendar",ief:"image/ief",iges:"model/iges",igs:"model/iges",iii:"application/x-iphone",info:"application/x-info",inp:"chemical/x-gamess-input",ins:"application/x-internet-signup",iso:"application/x-iso9660-image",isp:"application/x-internet-signup",ist:"chemical/x-isostar",istr:"chemical/x-isostar",jad:"text/vnd.sun.j2me.app-descriptor",jam:"application/x-jam",jar:"application/java-archive",java:"text/x-java",jdx:"chemical/x-jcamp-dx",jmz:"application/x-jmol",jng:"image/x-jng",jnlp:"application/x-java-jnlp-file",jp2:"image/jp2",jpe:"image/jpeg",jpeg:"image/jpeg",jpf:"image/jpx",jpg:"image/jpeg",jpg2:"image/jp2",jpm:"image/jpm",jpx:"image/jpx",js:"application/javascript",json:"application/json",kar:"audio/midi",key:"application/pgp-keys",kil:"application/x-killustrator",kin:"chemical/x-kinemage",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz",kpr:"application/x-kpresenter",kpt:"application/x-kpresenter",ksp:"application/x-kspread",kwd:"application/x-kword",kwt:"application/x-kword",latex:"application/x-latex",lha:"application/x-lha",lhs:"text/x-literate-haskell",lin:"application/bbolin",lsf:"video/x-la-asf",lsx:"video/x-la-asf",ltx:"text/x-tex",ly:"text/x-lilypond",lyx:"application/x-lyx",lzh:"application/x-lzh",lzx:"application/x-lzx",m3g:"application/m3g",m3u:"audio/x-mpegurl",m3u8:"application/x-mpegURL",m4a:"audio/mpeg",maker:"application/x-maker",man:"application/x-troff-man",mbox:"application/mbox",mcif:"chemical/x-mmcif",mcm:"chemical/x-macmolecule",mdb:"application/msaccess",me:"application/x-troff-me",mesh:"model/mesh",mid:"audio/midi",midi:"audio/midi",mif:"application/x-mif",mkv:"video/x-matroska",mm:"application/x-freemind",mmd:"chemical/x-macromodel-input",mmf:"application/vnd.smaf",mml:"text/mathml",mmod:"chemical/x-macromodel-input",mng:"video/x-mng",moc:"text/x-moc",mol:"chemical/x-mdl-molfile",mol2:"chemical/x-mol2",moo:"chemical/x-mopac-out",mop:"chemical/x-mopac-input",mopcrt:"chemical/x-mopac-input",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpc:"chemical/x-mopac-input",mpe:"video/mpeg",mpeg:"video/mpeg",mpega:"audio/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",mph:"application/x-comsol",mpv:"video/x-matroska",ms:"application/x-troff-ms",msh:"model/mesh",msi:"application/x-msi",mvb:"chemical/x-mopac-vib",mxf:"application/mxf",mxu:"video/vnd.mpegurl",nb:"application/mathematica",nbp:"application/mathematica",nc:"application/x-netcdf",nef:"image/x-nikon-nef",nwc:"application/x-nwc",o:"application/x-object",oda:"application/oda",odb:"application/vnd.oasis.opendocument.database",odc:"application/vnd.oasis.opendocument.chart",odf:"application/vnd.oasis.opendocument.formula",odg:"application/vnd.oasis.opendocument.graphics",odi:"application/vnd.oasis.opendocument.image",odm:"application/vnd.oasis.opendocument.text-master",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogg:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",old:"application/x-trash",one:"application/onenote",onepkg:"application/onenote",onetmp:"application/onenote",onetoc2:"application/onenote",opf:"application/oebps-package+xml",opus:"audio/ogg",orc:"audio/csound",orf:"image/x-olympus-orf",otf:"application/font-sfnt",otg:"application/vnd.oasis.opendocument.graphics-template",oth:"application/vnd.oasis.opendocument.text-web",otp:"application/vnd.oasis.opendocument.presentation-template",ots:"application/vnd.oasis.opendocument.spreadsheet-template",ott:"application/vnd.oasis.opendocument.text-template",oza:"application/x-oz-application",p:"text/x-pascal",p7r:"application/x-pkcs7-certreqresp",pac:"application/x-ns-proxy-autoconfig",pas:"text/x-pascal",pat:"image/x-coreldrawpattern",patch:"text/x-diff",pbm:"image/x-portable-bitmap",pcap:"application/vnd.tcpdump.pcap",pcf:"application/x-font-pcf","pcf.Z":"application/x-font-pcf",pcx:"image/pcx",pdb:"chemical/x-pdb",pdf:"application/pdf",pfa:"application/x-font",pfb:"application/x-font",pfr:"application/font-tdpfr",pgm:"image/x-portable-graymap",pgn:"application/x-chess-pgn",pgp:"application/pgp-encrypted",php:"#application/x-httpd-php",php3:"#application/x-httpd-php3",php3p:"#application/x-httpd-php3-preprocessed",php4:"#application/x-httpd-php4",php5:"#application/x-httpd-php5",phps:"#application/x-httpd-php-source",pht:"#application/x-httpd-php",phtml:"#application/x-httpd-php",pk:"application/x-tex-pk",pl:"text/x-perl",pls:"audio/x-scpls",pm:"text/x-perl",png:"image/png",pnm:"image/x-portable-anymap",pot:"text/plain",potm:"application/vnd.ms-powerpoint.template.macroEnabled.12",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",ppam:"application/vnd.ms-powerpoint.addin.macroEnabled.12",ppm:"image/x-portable-pixmap",pps:"application/vnd.ms-powerpoint",ppsm:"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppt:"application/vnd.ms-powerpoint",pptm:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",prf:"application/pics-rules",prt:"chemical/x-ncbi-asn1-ascii",ps:"application/postscript",psd:"image/x-photoshop",py:"text/x-python",pyc:"application/x-python-code",pyo:"application/x-python-code",qgs:"application/x-qgis",qt:"video/quicktime",qtl:"application/x-quicktimeplayer",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",rar:"application/rar",ras:"image/x-cmu-raster",rb:"application/x-ruby",rd:"chemical/x-mdl-rdfile",rdf:"application/rdf+xml",rdp:"application/x-rdp",rgb:"image/x-rgb",rhtml:"#application/x-httpd-eruby",rm:"audio/x-pn-realaudio",roff:"application/x-troff",ros:"chemical/x-rosdal",rpm:"application/x-redhat-package-manager",rss:"application/x-rss+xml",rtf:"application/rtf",rtx:"text/richtext",rxn:"chemical/x-mdl-rxnfile",scala:"text/x-scala",sce:"application/x-scilab",sci:"application/x-scilab",sco:"audio/csound",scr:"application/x-silverlight",sct:"text/scriptlet",sd:"chemical/x-mdl-sdfile",sd2:"audio/x-sd2",sda:"application/vnd.stardivision.draw",sdc:"application/vnd.stardivision.calc",sdd:"application/vnd.stardivision.impress",sds:"application/vnd.stardivision.chart",sdw:"application/vnd.stardivision.writer",ser:"application/java-serialized-object",sfd:"application/vnd.font-fontforge-sfd",sfv:"text/x-sfv",sgf:"application/x-go-sgf",sgl:"application/vnd.stardivision.writer-global",sh:"application/x-sh",shar:"application/x-shar",shp:"application/x-qgis",shtml:"text/html",shx:"application/x-qgis",sid:"audio/prs.sid",sig:"application/pgp-signature",sik:"application/x-trash",silo:"model/mesh",sis:"application/vnd.symbian.install",sisx:"x-epoc/x-sisx-app",sit:"application/x-stuffit",sitx:"application/x-stuffit",skd:"application/x-koan",skm:"application/x-koan",skp:"application/x-koan",skt:"application/x-koan",sldm:"application/vnd.ms-powerpoint.slide.macroEnabled.12",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",smi:"application/smil+xml",smil:"application/smil+xml",snd:"audio/basic",spc:"chemical/x-galactic-spc",spl:"application/x-futuresplash",spx:"audio/ogg",sql:"application/x-sql",src:"application/x-wais-source",srt:"text/plain",stc:"application/vnd.sun.xml.calc.template",std:"application/vnd.sun.xml.draw.template",sti:"application/vnd.sun.xml.impress.template",stw:"application/vnd.sun.xml.writer.template",sty:"text/x-tex",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",svgz:"image/svg+xml",sw:"chemical/x-swissprot",swf:"application/x-shockwave-flash",swfl:"application/x-shockwave-flash",sxc:"application/vnd.sun.xml.calc",sxd:"application/vnd.sun.xml.draw",sxg:"application/vnd.sun.xml.writer.global",sxi:"application/vnd.sun.xml.impress",sxm:"application/vnd.sun.xml.math",sxw:"application/vnd.sun.xml.writer",t:"application/x-troff",tar:"application/x-tar",taz:"application/x-gtar-compressed",tcl:"application/x-tcl",tex:"text/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",text:"text/plain",tgf:"chemical/x-mdl-tgf",tgz:"application/x-gtar-compressed",thmx:"application/vnd.ms-officetheme",tif:"image/tiff",tiff:"image/tiff",tk:"text/x-tcl",tm:"text/texmacs",torrent:"application/x-bittorrent",tr:"application/x-troff",ts:"video/MP2T",tsp:"application/dsptype",tsv:"text/tab-separated-values",ttf:"application/font-sfnt",ttl:"text/turtle",txt:"text/plain",uls:"text/iuls",ustar:"application/x-ustar",val:"chemical/x-ncbi-asn1-binary",vcard:"text/vcard",vcd:"application/x-cdlink",vcf:"text/vcard",vcs:"text/x-vcalendar",vmd:"chemical/x-vmd",vms:"chemical/x-vamas-iso14976",vrm:"x-world/x-vrml",vrml:"model/vrml",vsd:"application/vnd.visio",vss:"application/vnd.visio",vst:"application/vnd.visio",vsw:"application/vnd.visio",wad:"application/x-doom",wasm:"application/wasm",wav:"audio/wav",wax:"audio/x-ms-wax",wbmp:"image/vnd.wap.wbmp",wbxml:"application/vnd.wap.wbxml",webm:"video/webm",wk:"application/x-123",wm:"video/x-ms-wm",wma:"audio/x-ms-wma",wmd:"application/x-ms-wmd",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wmz:"application/x-ms-wmz",woff:"application/font-woff",wp5:"application/vnd.wordperfect5.1",wpd:"application/vnd.wordperfect",wrl:"model/vrml",wsc:"text/scriptlet",wvx:"video/x-ms-wvx",wz:"application/x-wingz",x3d:"model/x3d+xml",x3db:"model/x3d+binary",x3dv:"model/x3d+vrml",xbm:"image/x-xbitmap",xcf:"application/x-xcf",xcos:"application/x-scilab-xcos",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xlam:"application/vnd.ms-excel.addin.macroEnabled.12",xlb:"application/vnd.ms-excel",xls:"application/vnd.ms-excel",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.12",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.12",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlt:"application/vnd.ms-excel",xltm:"application/vnd.ms-excel.template.macroEnabled.12",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xml:"application/xml",xpi:"application/x-xpinstall",xpm:"image/x-xpixmap",xsd:"application/xml",xsl:"application/xslt+xml",xslt:"application/xslt+xml",xspf:"application/xspf+xml",xtel:"chemical/x-xtel",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",xyz:"chemical/x-xyz",xz:"application/x-xz",zip:"application/zip",webp:"image/webp"};function dt(t){return new n.Transform({async transform(e,a,n){t(e.length),this.push(e),n()}})}function ht(t,e){const a=dt(e);return ct(t,a,"createReadNReadStream")}let ft=null;ft={__proto__:null,CRC:class{constructor(){this.value="0"}reset(){this.value="0"}async updateBlob(){throw new w("Not implemented in node.js environment.")}update(t){return this.value=p.crc64(t,this.value),this.value}getCrc64(){return this.value}},combineCrc64:p.combineCrc64};const{CRC:mt,combineCrc64:yt}=ft;function gt(t){return new n.Transform({async transform(e,a,n){try{const a=e.length;let o=!1;for(;!o;){const{ok:e,timeToWait:n}=await t.Acquire(a);e||await xt(n),o=e}this.push(e),n()}catch(t){n(t)}}})}function xt(t){return new Promise(e=>{setTimeout(()=>e(""),t)})}var kt={__proto__:null,createDefaultRateLimiter:function(t,e){const a=Math.max(10240,t),n={rate:Math.max(1024,e),capacity:a,currentAmount:a,lastConsumeTime:Date.now()};return{Acquire:async t=>{t>n.capacity&&(t=n.capacity);const e=Date.now(),a=Math.floor((e-n.lastConsumeTime)/1e3*n.rate);return a+n.currentAmount>n.capacity?n.currentAmount=n.capacity:n.currentAmount+=a,t>n.currentAmount?{ok:!1,timeToWait:Math.ceil((t-n.currentAmount)/n.rate*1e3)}:(n.lastConsumeTime=e,n.currentAmount=n.currentAmount-t,{ok:!0,timeToWait:0})}}},createRateLimiterStream:function(t,e){const a=gt(e);return ct(t,a,"createRateLimiterStream")},wait:xt};let bt=null;bt=kt;const{createDefaultRateLimiter:Tt,createRateLimiterStream:vt}=bt;class wt extends n.Readable{constructor(t){super(),this.buf=void 0,this.lastPos=0,this.buf=t}_read(t){const e=this.buf.length;let a=Math.min(t,e-this.lastPos);this.lastPos>=e?this.push(null):(this.push(this.buf.slice(this.lastPos,this.lastPos+a)),this.lastPos+=a)}}function St(t){return new n.Transform({async transform(e,a,n){t(e),this.push(e),n()}})}function Et(t,e){const a=St(t=>e.update(t));return ct(t,a,"createCrcReadStream")}var Ct;function Bt(t){if(("string"==typeof t?t:t.key).length<1)throw new w("invalid object name, the length must be greater than 1")}function Pt(t,e){if(K(t))return t.length;if(G(t))return t.size;if(e&&e["content-length"]){const t=+e["content-length"];if(t>=0)return t}return null}async function It(t){const e=function({body:t,dataTransferCallback:e,makeRetryStream:a,rateLimiter:n}){let o=t;if(K(o)){const t=o;a=()=>new wt(t),o=new wt(t)}if(q(o)&&(n&&At(n)&&(o=vt(o,n)),o=ht(o,e),a)){const t=a;return{body:o,makeRetryStream:()=>{let a=t();return a?(n&&At(n)&&(a=vt(a,n)),a=ht(a,e),a):a}}}return{body:o,makeRetryStream:void 0}}(t);return async function({body:t,beforeRetry:e,makeRetryStream:a,enableCRC:n}){if(!n)return{body:t,beforeRetry:e,makeRetryStream:a};let o=t;const i=new mt;if(q(t)&&(o=Et(t,i),a)){const t=a;a=()=>{const e=t();return e?Et(e,i):e}}return{body:o,beforeRetry:()=>{i.reset(),null==e||e()},makeRetryStream:a,crc:i}}(t={...t,...e})}function Rt(t,e){return`/${t}/${encodeURIComponent(e)}`}function At(t){if(!(null!=t&&t.Acquire&&(null==t?void 0:t.Acquire)instanceof Function))throw new w("The rateLimiter is not valid function");return!0}function Dt(t){"object"==typeof t&&console.warn("The `checkpoint` parameter should be passed as a string in node.js environment, representing a file or directory.Passing a checkpoint object to it will be removed in the future.")}!function(t){t.HeaderRestore="x-tos-restore",t.HeaderRestoreExpiryDays="x-tos-restore-expiry-days",t.HeaderRestoreRequestDate="x-tos-restore-request-date",t.HeaderRestoreTier="x-tos-restore-tier",t.HeaderProjectName="x-tos-project-name",t.HeaderReplicationStatus="x-tos-replication-status"}(Ct||(Ct={}));const Ot=t=>{if(!t)return;const e=null==t?void 0:t[Ct.HeaderRestore];if(e){var a,n,o;const c=null!=(a=null==(n=(null!=e?e:"").split('",')[1])||null==n.split||null==(o=n.split("="))?void 0:o[1])?a:"",s='ongoing-request="true"'===(null==e?void 0:e.trim()),r={RestoreStatus:{OngoingRequest:s,ExpiryDate:c}};var i;return s&&(r.RestoreParam={ExpiryDays:t[Ct.HeaderRestoreExpiryDays]?Number(t[Ct.HeaderRestoreExpiryDays]):0,RequestDate:null!=(i=t[Ct.HeaderRestoreRequestDate])?i:"",Tier:t[Ct.HeaderRestoreTier]}),r}};var Mt;(Mt=exports.DataTransferType||(exports.DataTransferType={}))[Mt.Started=1]="Started",Mt[Mt.Rw=2]="Rw",Mt[Mt.Succeed=3]="Succeed",Mt[Mt.Failed=4]="Failed";const _t=function(t,e){if(K(t))throw new w("not support buffer in browser environment");return function(t,e){return e?t.toString(function(t){switch(t){case"utf-8":return m;case"base64":return h;case"hex":return f;default:throw new w("The coding is not supported")}}(e)):t}(d(t),e)};function jt(t,e){return e?t.digest(e):t.digest()}let Nt=null;Nt={__proto__:null,hmacSha256:function(t,e,a){return jt(y.createHmac("sha256",t).update(e),a)},hashSha256:function(t,e){return jt(y.createHash("sha256").update(t),e)},hashMd5:function(t,e){return jt(y.createHash("md5").update(t),e)},parse:function(t,e){return Buffer.from(t,e)},stringify:function(t,e){return t.toString(e)}};const{hmacSha256:Lt,hashSha256:Ut,hashMd5:zt,parse:Ft,stringify:Gt}=Nt;async function Kt(t){const{uploadId:e,partNumber:a,body:n,enableContentMD5:o=!1}=t,i=U(t.headers);t.headers=i,Q(t,["trafficLimit","ssecAlgorithm","ssecKey","ssecKeyMD5"]);const c=Pt(n);if(c&&null==i["content-length"]&&(i["content-length"]=c.toFixed(0)),o&&null==i["content-md5"])if(q(n)&&t.makeRetryStream){const e=t.makeRetryStream();if(e){let t=Buffer.from([]);for await(const a of e)t=Buffer.concat([t,"string"==typeof a?Buffer.from(a):a]);const a=zt(t,"base64");i["content-md5"]=a}}else console.warn("current not support enableMD5Checksum");const s=Pt(t.body,i),r=null!=s;r||!t.dataTransferStatusChange&&!t.progress||console.warn("Don't get totalSize of uploadPart's body, the `dataTransferStatusChange` callback will not trigger. You can use `uploadPartFromFile` instead");let u=0;const{dataTransferStatusChange:l,progress:p}=t,d=(t,e=0)=>{if(!r||e<0)return;if(!l&&!p)return;u+=e,null==l||l({type:t,rwOnceBytes:e,consumedBytes:u,totalBytes:s});const a=0===s?t===exports.DataTransferType.Succeed?1:0:u/s;1===a?t===exports.DataTransferType.Succeed&&(null==p||p(a)):null==p||p(a)},h=await It({body:t.body,dataTransferCallback:t=>d(exports.DataTransferType.Rw,t),beforeRetry:t.beforeRetry,makeRetryStream:t.makeRetryStream,enableCRC:this.opts.enableCRC,rateLimiter:t.rateLimiter});d(exports.DataTransferType.Started);const[f,m]=await F((async()=>{const n=await this._fetchObject(t,"PUT",{partNumber:a,uploadId:e},i,h.body,{handleResponse:t=>({partNumber:a,ETag:t.headers.etag,serverSideEncryption:t.headers["x-tos-server-side-encryption"],serverSideDataEncryption:t.headers["x-tos-server-side-data-encryption"],serverSideEncryptionKeyId:t.headers["x-tos-server-side-encryption-kms-key-id"],ssecAlgorithm:t.headers["x-tos-server-side-encryption-customer-algorithm"],ssecKeyMD5:t.headers["x-tos-server-side-encryption-customer-key-MD5"],hashCrc64ecma:t.headers["x-tos-hash-crc64ecma"]}),axiosOpts:{__retryConfig__:{beforeRetry:()=>{u=0,null==h.beforeRetry||h.beforeRetry()},makeRetryStream:h.makeRetryStream},onUploadProgress:t=>{d(exports.DataTransferType.Rw,t.loaded-u)}}});return this.opts.enableCRC&&h.crc&&Z(h.crc,n.headers),n})());if(f||!m)throw d(exports.DataTransferType.Failed),f;return d(exports.DataTransferType.Succeed),m}async function qt(t){return Kt.call(this,t)}async function $t(t){var e,a;const n=await P(t.filePath),o=null!=(e=t.offset)?e:0,i=Math.min(n.size,o+(null!=(a=t.partSize)?a:n.size)),c=ot(()=>C(t.filePath,{start:o,end:i-1}));try{return await Kt.call(this,{...t,body:c.make(),headers:{...t.headers||{},"content-length":""+(i-o)},makeRetryStream:c.make})}catch(t){throw it(c.getLastStream(),t),t}}async function Vt(t){var e;t.headers=null!=(e=t.headers)?e:{},Q(t,["callback","callbackVar","forbidOverwrite"]);const a=e=>{const a=e.headers,n={VersionID:a["x-tos-version-id"],ETag:a.etag,Bucket:t.bucket||this.opts.bucket||"",Location:a.location,HashCrc64ecma:a["x-tos-hash-crc64ecma"],Key:t.key,...e.data};return t.callback&&(n.CallbackResult=""+JSON.stringify(e.data)),n};if(t.completeAll){var n;if((null==(n=t.parts)?void 0:n.length)>0)throw new w("Should not specify both 'completeAll' and 'parts' params.");return this._fetchObject(t,"POST",{uploadId:t.uploadId},{...t.headers,"x-tos-complete-all":"yes"},void 0,{handleResponse:a})}return this._fetchObject(t,"POST",{uploadId:t.uploadId},{...t.headers},{Parts:t.parts.map(t=>({ETag:t.eTag,PartNumber:t.partNumber}))},{handleResponse:a})}class Ht extends n.Readable{_read(){this.push(null)}}var Wt;(Wt=exports.UploadEventType||(exports.UploadEventType={}))[Wt.CreateMultipartUploadSucceed=1]="CreateMultipartUploadSucceed",Wt[Wt.CreateMultipartUploadFailed=2]="CreateMultipartUploadFailed",Wt[Wt.UploadPartSucceed=3]="UploadPartSucceed",Wt[Wt.UploadPartFailed=4]="UploadPartFailed",Wt[Wt.UploadPartAborted=5]="UploadPartAborted",Wt[Wt.CompleteMultipartUploadSucceed=6]="CompleteMultipartUploadSucceed",Wt[Wt.CompleteMultipartUploadFailed=7]="CompleteMultipartUploadFailed";const Jt=[403,404,405];async function Qt(t){var e,a,n;const{cancelToken:o,enableContentMD5:i=!1}=t,c=U(t.headers);t.headers=c,Q(t,["encodingType","cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","serverSideEncryption","serverSideDataEncryption","meta","websiteRedirectLocation","storageClass"]);const s=()=>o&&!!o.reason;Dt(t.checkpoint);const r=await(async()=>"string"==typeof t.file?P(t.file):null)(),u=await(async()=>{const{file:e}=t;if(r)return r.size;if(K(e))return e.length;if(G(e))return e.size;throw new w("`file` must be string, Buffer, File or Blob")})(),l=await(async()=>{if("string"==typeof t.checkpoint){const{checkpoint:e}=t;let a=null;try{a=await P(e)}catch(t){const e=t;if("ENOENT"!==e.code)throw e}const n=a?a.isDirectory():e.endsWith("/"),o=n?g.resolve(e,"@@checkpoint-file-placeholder@@"):g.resolve(e),i=g.dirname(o);if(await D(i),n)return{filePath:o,filePathIsPlaceholder:!0};try{return{filePath:o,filePathIsPlaceholder:!1,record:a?await nt(o):void 0}}catch(t){throw console.warn("the checkpoint file is invalid JSON format. please check checkpoint file"),t}}return"object"==typeof t.checkpoint?{record:t.checkpoint}:{}})();await(async()=>{var t;if(r&&null!=(t=l.record)&&t.file_info){var e;const{last_modified:t,file_size:a}=null==(e=l.record)?void 0:e.file_info;r.mtimeMs===t&&r.size===a||(console.warn(`The file has been modified since ${new Date(t)}, so the checkpoint file is invalid, and specified file will be uploaded again.`),delete l.record)}})();const p=ut(u,t.partSize||(null==(e=l.record)?void 0:e.part_size)||20971520,!0);l.record&&l.record.part_size!==p&&(console.warn("The partSize param does not equal the partSize in checkpoint file, so the checkpoint file is invalid, and specified file will be uploaded again."),delete l.record);let d=t.bucket||this.opts.bucket||"";const h=t.key;let f="",m=[];const y=function(t,e){const a=[];for(let n=0;;++n){const o=n*e,i=Math.min(e,t-o);if(a.push({offset:o,partSize:i,partNumber:n+1}),(n+1)*e>=t)break}return a}(u,p),x=((null==(a=l.record)?void 0:a.parts_info)||[]).filter(t=>t.is_completed).reduce((t,e)=>t+e.part_size,0);let k=x;const b=(null==(n=l.record)?void 0:n.parts_info)||[],T=new Map;b.forEach(t=>T.set(t.part_number,t));const E=()=>{const t={bucket:d,key:h,part_size:p,upload_id:f,parts_info:b};return r&&(t.file_info={last_modified:r.mtimeMs,file_size:r.size}),t},C=e=>{if(!t.uploadEventChange)return;const a={bucket:d,uploadId:f,key:h,...e};l.filePath&&(a.checkpointFile=l.filePath),t.uploadEventChange(a)};let B;!function(t){t[t.start=1]="start",t[t.uploadPartSucceed=2]="uploadPartSucceed",t[t.completeMultipartUploadSucceed=3]="completeMultipartUploadSucceed"}(B||(B={}));const A=e=>{t.progress&&(k===u&&e===B.uploadPartSucceed||t.progress(e===B.start&&0===u?0:u?k/u:1,E()))};let M=x;const{dataTransferStatusChange:_}=t,j=(t,e=0)=>{_&&(M+=e,null==_||_({type:t,rwOnceBytes:e,consumedBytes:M,totalBytes:u}))},N=at(async()=>{if(l.filePath){const t=JSON.stringify(E(),null,2),e=g.dirname(l.filePath);await D(e),await I(l.filePath,t,"utf-8")}}),L=async(t,e)=>{let a=T.get(t.partNumber);a||(a={part_number:t.partNumber,offset:t.offset,part_size:t.partSize,is_completed:!1,etag:"",hash_crc64ecma:""},b.push(a),T.set(a.part_number,a)),e.err||(a.is_completed=!0,a.etag=e.res.ETag,a.hash_crc64ecma=e.res.hashCrc64ecma),await N();const n={partNumber:a.part_number,partSize:a.part_size,offset:a.offset};if(e.err){const t=e.err;let a=exports.UploadEventType.UploadPartFailed;return t instanceof v&&Jt.includes(t.statusCode)&&(a=exports.UploadEventType.UploadPartAborted),void C({type:a,err:t,uploadPartInfo:n})}n.etag=e.res.ETag,k+=n.partSize,C({type:exports.UploadEventType.UploadPartSucceed,uploadPartInfo:n}),A(B.uploadPartSucceed)};if(l.record){d=l.record.bucket,f=l.record.upload_id;const t=new Set((l.record.parts_info||[]).filter(t=>t.is_completed).map(t=>t.part_number));m=y.filter(e=>!t.has(e.partNumber))}else{try{const{data:e}=await rt.call(this,t);if(s())throw new S("cancel uploadFile");var z;d=e.Bucket,f=e.UploadId,l.filePathIsPlaceholder&&(l.filePath=null==(z=l.filePath)?void 0:z.replace("@@checkpoint-file-placeholder@@",function(t,e){return`${e}.${zt(`${t}.${e}`,"hex")}.upload`.replace(/[\\/]/g,"")}(d,h))),C({type:exports.UploadEventType.CreateMultipartUploadSucceed})}catch(t){const e=t;throw C({type:exports.UploadEventType.CreateMultipartUploadFailed,err:e}),e}m=y}A(B.start),j(exports.DataTransferType.Started);const[q,$]=await F((async()=>{let e=null,a=0;if(await Promise.all(Array.from({length:t.taskNum||1}).map(async()=>{let n=void 0,o=0,r=null,u=null;try{for(;;){var l;const u=a++;if(u>=m.length)return;function p(t,e){const{offset:a,partSize:o}=e,i=a+o;if(n)return n.make();if(G(t))return t.slice(a,i);if(K(t))return t.slice(a,i);throw new w("`file` must be string, Buffer, File or Blob")}r=m[u],n=Xt(t.file,r);const{data:y}=await Kt.call(this,{bucket:d,key:h,uploadId:f,body:p(t.file,r),enableContentMD5:i,makeRetryStream:null==(l=n)?void 0:l.make,beforeRetry:()=>{M-=o,o=0},partNumber:r.partNumber,headers:{"content-length":""+r.partSize,"x-tos-server-side-encryption-customer-algorithm":c["x-tos-server-side-encryption-customer-algorithm"],"x-tos-server-side-encryption-customer-key":c["x-tos-server-side-encryption-customer-key"],"x-tos-server-side-encryption-customer-key-md5":c["x-tos-server-side-encryption-customer-key-md5"]},dataTransferStatusChange(t){t.type===exports.DataTransferType.Rw&&(s()||e||(o+=t.rwOnceBytes,j(t.type,t.rwOnceBytes)))},trafficLimit:t.trafficLimit,rateLimiter:t.rateLimiter});if(s())throw new S("cancel uploadFile");if(e)throw new S("cancel uploadFile by internal error(`firstErr`)");await L(r,{res:y})}}catch(t){u=t,e||(e=u)}try{var y;u?r&&await L(r,{err:u}):(it(null==(y=n)?void 0:y.getLastStream(),u),M-=o,o=0)}catch(t){O("error while clearing resources of `uploadFile` task, err:",t)}})),e)throw e;const n=(E().parts_info||[]).map(t=>({eTag:t.etag,partNumber:t.part_number})),[o,r]=await F(Vt.call(this,{bucket:d,key:h,uploadId:f,parts:n}));if(o||!r)throw C({type:exports.UploadEventType.CompleteMultipartUploadFailed}),o;if(C({type:exports.UploadEventType.CompleteMultipartUploadSucceed}),A(B.completeMultipartUploadSucceed),await(async()=>{l.filePath&&await R(l.filePath).catch(t=>{console.warn("remove checkpoint file failure, you can remove it by hand.\n",`checkpoint file path: ${l.filePath}\n`,t.message)})})(),this.opts.enableCRC&&r.data.HashCrc64ecma&&function(t){var e,a,n;const o=(null==(e=t.file_info)?void 0:e.file_size)||0;let i="0";const c=null!=(a=null==(n=t.parts_info)||null==n.sort?void 0:n.sort((t,e)=>t.part_number-e.part_number))?a:[];for(const t of c)i=yt(i,t.hash_crc64ecma,Math.min(t.part_size,o-t.offset));return i}(E())!==r.data.HashCrc64ecma)throw new w("crc of entire file mismatch.");return r})());if(q||!$)throw j(exports.DataTransferType.Failed),q;return j(exports.DataTransferType.Succeed),$}function Xt(t,e){const{offset:a,partSize:n}=e,o=a+n;if("string"==typeof t)return ot(()=>n?C(t,{start:a,end:o-1}):new Ht)}var Yt,Zt,te,ee,ae,ne,oe,ie,ce,se,re,ue,le,pe,de,he,fe,me,ye,ge,xe,ke,be,Te,ve,we,Se,Ee,Ce,Be,Pe,Ie,Re,Ae;async function De(t){const e="string"==typeof t?{key:t}:t,a=U(e.headers);e.headers=a;const n={};return e.versionId&&(n.versionId=e.versionId),Q(e,["ifMatch","ifModifiedSince","ifNoneMatch","ifUnmodifiedSince","ssecAlgorithm","ssecKey","ssecKeyMD5"]),this._fetchObject(t,"HEAD",n,(null==e?void 0:e.headers)||{},void 0,{handleResponse:t=>{const e={...t.headers,ReplicationStatus:t.headers[Ct.HeaderReplicationStatus]},a=Ot(t.headers);return a&&(e.RestoreInfo=a),e}})}async function Oe(t){const{uploadId:e,partNumber:a}=t,n=U(t.headers);if(t.headers=n,Q(t,["copySourceRange","copySourceSSECAlgorithm","copySourceSSECKey","copySourceSSECKeyMD5","ssecAlgorithm","ssecKey","ssecKeyMD5","trafficLimit"]),t.srcBucket&&t.srcKey){var o;let e=Rt(t.srcBucket,t.srcKey);t.srcVersionID&&(e+="?versionId="+t.srcVersionID),n["x-tos-copy-source"]=null!=(o=n["x-tos-copy-source"])?o:e}if(null==t.copySourceRange&&(null!=t.copySourceRangeStart||null!=t.copySourceRangeEnd)){var i;const e=`bytes=${null!=t.copySourceRangeStart?""+t.copySourceRangeStart:""}-${null!=t.copySourceRangeEnd?""+t.copySourceRangeEnd:""}`;n["x-tos-copy-source-range"]=null!=(i=n["x-tos-copy-source-range"])?i:e}const[c,s]=await F(this._fetchObject(t,"PUT",{partNumber:a,uploadId:e},n,void 0,{handleResponse:t=>({...t.data,SSECAlgorithm:t.headers[W.ssecAlgorithm],SSECKeyMD5:t.headers[W.ssecKeyMD5]})}));if(c||!s||!s.data.ETag)throw c;return s}async function Me(t){const e=U(t.headers);if(t.headers=e,Q(t,["cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","copySourceIfMatch","copySourceIfModifiedSince","copySourceIfNoneMatch","copySourceIfUnmodifiedSince","copySourceSSECAlgorithm","copySourceSSECKey","copySourceSSECKeyMD5","acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","serverSideEncryption","metadataDirective","meta","websiteRedirectLocation","storageClass","trafficLimit","forbidOverwrite","ifMatch"]),t.srcBucket&&t.srcKey){var a;let n=Rt(t.srcBucket,t.srcKey);t.srcVersionID&&(n+="?versionId="+t.srcVersionID),e["x-tos-copy-source"]=null!=(a=e["x-tos-copy-source"])?a:n}const[n,o]=await F(this._fetchObject(t,"PUT",{},e));if(n||!o||!o.data.ETag)throw n;return o}(Yt=exports.ACLType||(exports.ACLType={})).ACLPrivate="private",Yt.ACLPublicRead="public-read",Yt.ACLPublicReadWrite="public-read-write",Yt.ACLAuthenticatedRead="authenticated-read",Yt.ACLBucketOwnerRead="bucket-owner-read",Yt.ACLBucketOwnerFullControl="bucket-owner-full-control",Yt.ACLBucketOwnerEntrusted="bucket-owner-entrusted",Yt.ACLDefault="default",(Zt=exports.StorageClassType||(exports.StorageClassType={})).StorageClassStandard="STANDARD",Zt.StorageClassIa="IA",Zt.StorageClassArchiveFr="ARCHIVE_FR",Zt.StorageClassColdArchive="COLD_ARCHIVE",Zt.StorageClassIntelligentTiering="INTELLIGENT_TIERING",Zt.StorageClassArchive="ARCHIVE",Zt.StorageClassDeepColdArchive="DEEP_COLD_ARCHIVE",(te=exports.MetadataDirectiveType||(exports.MetadataDirectiveType={})).MetadataDirectiveCopy="COPY",te.MetadataDirectiveReplace="REPLACE",(ee=exports.AzRedundancyType||(exports.AzRedundancyType={})).AzRedundancySingleAz="single-az",ee.AzRedundancyMultiAz="multi-az",(ae=exports.PermissionType||(exports.PermissionType={})).PermissionRead="READ",ae.PermissionWrite="WRITE",ae.PermissionReadAcp="READ_ACP",ae.PermissionWriteAcp="WRITE_ACP",ae.PermissionFullControl="FULL_CONTROL",ae.PermissionReadNONLIST="READ_NON_LIST",(ne=exports.GranteeType||(exports.GranteeType={})).GranteeGroup="Group",ne.GranteeUser="CanonicalUser",(oe=exports.CannedType||(exports.CannedType={})).CannedAllUsers="AllUsers",oe.CannedAuthenticatedUsers="AuthenticatedUsers",(ie=exports.HttpMethodType||(exports.HttpMethodType={})).HttpMethodGet="GET",ie.HttpMethodPut="PUT",ie.HttpMethodPost="POST",ie.HttpMethodDelete="DELETE",ie.HttpMethodHead="HEAD",(ce=exports.StorageClassInheritDirectiveType||(exports.StorageClassInheritDirectiveType={})).StorageClassInheritDirectiveDestinationBucket="DESTINATION_BUCKET",ce.StorageClassInheritDirectiveSourceObject="SOURCE_OBJECT",(se=exports.ReplicationStatusType||(exports.ReplicationStatusType={})).Complete="COMPLETE",se.Pending="PENDING",se.Failed="FAILED",se.Replica="REPLICA",(re=exports.LifecycleStatusType||(exports.LifecycleStatusType={})).Enabled="Enabled",re.Disabled="Disabled",(ue=exports.RedirectType||(exports.RedirectType={})).Mirror="Mirror",ue.Async="Async",(le=exports.StatusType||(exports.StatusType={})).Enabled="Enabled",le.Disabled="Disabled",(pe=exports.TierType||(exports.TierType={})).TierStandard="Standard",pe.TierExpedited="Expedited",pe.TierBulk="Bulk",(de=exports.VersioningStatusType||(exports.VersioningStatusType={})).Enabled="Enabled",de.Suspended="Suspended",de.NotSet="",de.Enable="Enabled",de.Disable="",(he=exports.AccessPointStatusType||(exports.AccessPointStatusType={})).Ready="READY",he.Creating="CREATING",he.Created="CREATED",he.Deleting="DELETING",(fe=exports.TransferAccelerationStatusType||(exports.TransferAccelerationStatusType={})).Activating="AccelerationActivating",fe.Activated="AccelerationActivated",fe.Terminated="AccelerationTerminated",(me=exports.MRAPMirrorBackRedirectPolicyType||(exports.MRAPMirrorBackRedirectPolicyType={})).ClosestFirst="Closest-First",me.LatestFirst="Latest-First",(ye=exports.WorkflowExecutionStateType||(exports.WorkflowExecutionStateType={})).Success="Success",ye.Running="Running",ye.Submitted="Submitted",ye.Failed="Failed",(ge=exports.FileCompressFlatten||(exports.FileCompressFlatten={}))[ge.KeepStructure=0]="KeepStructure",ge[ge.FlattenAll=1]="FlattenAll",ge[ge.PrefixAsDirectory=2]="PrefixAsDirectory",ge[ge.PrefixContentsOnly=3]="PrefixContentsOnly",(xe=exports.FileUncompressPrefixReplaced||(exports.FileUncompressPrefixReplaced={}))[xe.NoExtraPrefix=0]="NoExtraPrefix",xe[xe.WithArchiveName=1]="WithArchiveName",xe[xe.FullArchivePath=2]="FullArchivePath",(ke=exports.AccessPointStatus||(exports.AccessPointStatus={})).Enable="enable",ke.Disable="disable",ke.Creating="creating",ke.Deleting="deleting",(be=exports.AcceleratorPrefetchJobStatus||(exports.AcceleratorPrefetchJobStatus={})).Null="NULL",be.Idle="IDLE",be.Running="RUNNING",be.Stopping="STOPPING",be.Complete="COMPLETE",(Te=exports.AuditJobStateType||(exports.AuditJobStateType={})).Submitted="Submitted",Te.Running="Running",Te.Success="Success",Te.Failed="Failed",Te.Paused="Paused",Te.Canceled="Canceled",(ve=exports.AuditScanType||(exports.AuditScanType={})).Manifest="Manifest",ve.Scan="Scan",(we=exports.AuditType||(exports.AuditType={})).Image="image",we.Video="video",we.Audio="audio",(Se=exports.CallbackTriggerModeType||(exports.CallbackTriggerModeType={})).Freeze="freeze",Se.Sensitive="sensitive",Se.Failure="failure",(Ee=exports.FreezeModeType||(exports.FreezeModeType={})).Archive="archive",Ee.Private="private",(Ce=exports.TemplateTagType||(exports.TemplateTagType={})).AudioConvert="AudioConvert",Ce.Transcode="Transcode",(Be=exports.AudioContainerFormatType||(exports.AudioContainerFormatType={})).Wav="wav",Be.Mp3="mp3",Be.Aac="aac",Be.Flac="flac",Be.Oga="oga",Be.Ac3="ac3",Be.Opus="opus",function(t){t.Mp4="mp4",t.Ts="ts"}(Pe||(Pe={})),(Ie=exports.SampleFormatType||(exports.SampleFormatType={})).Fltp="fltp",Ie.S16p="s16p",Ie.S32p="s32p",Ie.S16="s16",Ie.S32="s32",(exports.DataType||(exports.DataType={})).DataTypeFloat32="float32",(Re=exports.DistanceMetricType||(exports.DistanceMetricType={})).DistanceMetricEuclidean="euclidean",Re.DistanceMetricCosine="cosine",(Ae=exports.ResumableCopyEventType||(exports.ResumableCopyEventType={}))[Ae.CreateMultipartUploadSucceed=1]="CreateMultipartUploadSucceed",Ae[Ae.CreateMultipartUploadFailed=2]="CreateMultipartUploadFailed",Ae[Ae.UploadPartCopySucceed=3]="UploadPartCopySucceed",Ae[Ae.UploadPartCopyFailed=4]="UploadPartCopyFailed",Ae[Ae.UploadPartCopyAborted=5]="UploadPartCopyAborted",Ae[Ae.CompleteMultipartUploadSucceed=6]="CompleteMultipartUploadSucceed",Ae[Ae.CompleteMultipartUploadFailed=7]="CompleteMultipartUploadFailed";const _e=[403,404,405];async function je(t){var e,a,n;const{cancelToken:o}=t,i=()=>o&&!!o.reason;Dt(t.checkpoint);const{data:c}=await De.call(this,{bucket:t.srcBucket,key:t.srcKey,versionId:t.srcVersionId}),s=c.etag,r=+c["content-length"],u=await(async()=>{if("string"==typeof t.checkpoint){const{checkpoint:e}=t;let a=null;try{a=await P(e)}catch(t){const e=t;if("ENOENT"!==e.code)throw e}const n=a?a.isDirectory():e.endsWith("/"),o=n?g.resolve(e,"@@checkpoint-file-placeholder@@"):g.resolve(e),i=g.dirname(o);return await D(i),n?{filePath:o,filePathIsPlaceholder:!0}:{filePath:o,filePathIsPlaceholder:!1,record:a?await nt(o):void 0}}return"object"==typeof t.checkpoint?{record:t.checkpoint}:{}})();await(async()=>{var t;if(null!=(t=u.record)&&t.copy_source_object_info){var e;const{last_modified:t,object_size:a}=null==(e=u.record)?void 0:e.copy_source_object_info;c["last-modified"]===t&&+c["content-length"]===a||(console.warn(`The file has been modified since ${new Date(t)}, so the checkpoint file is invalid, and specified file will be uploaded again.`),delete u.record)}})();const l=ut(r,t.partSize||(null==(e=u.record)?void 0:e.part_size)||20971520,!0);u.record&&u.record.part_size!==l&&(console.warn("The partSize param does not equal the partSize in checkpoint file, so the checkpoint file is invalid, and specified file will be uploaded again."),delete u.record);let p=t.bucket||this.opts.bucket||"";const d=t.key;let h="",f=[];const m=function(t,e){const a=[];for(let n=0;;++n){const o=n*e,i=Math.min(e,t-o);if(a.push({offset:o,partSize:i,partNumber:n+1}),(n+1)*e>=t)break}return a}(r,l);let y=((null==(a=u.record)?void 0:a.parts_info)||[]).filter(t=>t.is_completed).reduce((t,e)=>t+e.copy_source_range_end-e.copy_source_range_start+1,0);const k=(null==(n=u.record)?void 0:n.parts_info)||[],b=new Map;k.forEach(t=>b.set(t.part_number,t));const T=()=>({bucket:p,key:d,part_size:l,upload_id:h,parts_info:k,copy_source_object_info:{last_modified:c["last-modified"],etag:c.etag,hash_crc64ecma:c["x-tos-hash-crc64ecma"]||"",object_size:+c["content-length"]}}),E=e=>{if(!t.copyEventListener)return;const a={bucket:p,uploadId:h,key:d,...e};u.filePath&&(a.checkpointFile=u.filePath),t.copyEventListener(a)};let C;!function(t){t[t.start=1]="start",t[t.uploadPartSucceed=2]="uploadPartSucceed",t[t.completeMultipartUploadSucceed=3]="completeMultipartUploadSucceed"}(C||(C={}));const B=e=>{t.progress&&(y===r&&e===C.uploadPartSucceed||t.progress(e===C.start&&0===r?0:r?y/r:1,T()))},A=at(async()=>{if(u.filePath){const t=JSON.stringify(T(),null,2),e=g.dirname(u.filePath);await D(e),await I(u.filePath,t,"utf-8")}}),O=async(t,e)=>{let a=b.get(t.partNumber);const n=t.offset,o=Math.min(t.offset+l-1,r-1);a||(a={part_number:t.partNumber,copy_source_range_start:n,copy_source_range_end:o,is_completed:!1,etag:""},k.push(a),b.set(a.part_number,a)),e.err||(a.is_completed=!0,a.etag=e.res.ETag),await A();const i={partNumber:a.part_number,copySourceRangeEnd:a.copy_source_range_end,copySourceRangeStart:a.copy_source_range_start};if(e.err){const t=e.err;let a=exports.ResumableCopyEventType.UploadPartCopyFailed;return t instanceof v&&_e.includes(t.statusCode)&&(a=exports.ResumableCopyEventType.UploadPartCopyAborted),void E({type:a,err:t,copyPartInfo:i})}i.etag=e.res.ETag,y+=i.copySourceRangeEnd-i.copySourceRangeStart+1,E({type:exports.ResumableCopyEventType.UploadPartCopySucceed,copyPartInfo:i}),B(C.uploadPartSucceed)};if(u.record){p=u.record.bucket,h=u.record.upload_id;const t=new Set((u.record.parts_info||[]).filter(t=>t.is_completed).map(t=>t.part_number));f=m.filter(e=>!t.has(e.partNumber))}else{try{const{data:e}=await rt.call(this,x(t));if(i())throw new S("cancel uploadFile");var M;p=e.Bucket,h=e.UploadId,u.filePathIsPlaceholder&&(u.filePath=null==(M=u.filePath)?void 0:M.replace("@@checkpoint-file-placeholder@@",[(_={...t,bucket:p}).srcBucket,_.srcKey,_.srcVersionId,_.bucket,_.key,"copy"].filter(Boolean).join(".").replace(/[\\/]/g,""))),E({type:exports.ResumableCopyEventType.CreateMultipartUploadSucceed})}catch(t){const e=t;throw E({type:exports.ResumableCopyEventType.CreateMultipartUploadFailed,err:e}),e}f=m}var _;return B(C.start),0===r?(async()=>{let e=Rt(t.srcBucket,t.srcKey);t.srcVersionId&&(e+="?versionId="+t.srcVersionId);const a={...t.headers,"x-tos-copy-source":e,"x-tos-copy-source-if-match":s},[n,o]=await F(Me.call(this,{bucket:t.bucket,key:t.key,headers:a,trafficLimit:t.trafficLimit}));if(n||!o)throw E({type:exports.ResumableCopyEventType.UploadPartCopyFailed}),n;return B(C.completeMultipartUploadSucceed),E({type:exports.ResumableCopyEventType.UploadPartCopySucceed,copyPartInfo:{partNumber:0,copySourceRangeStart:0,copySourceRangeEnd:0}}),E({type:exports.ResumableCopyEventType.CompleteMultipartUploadSucceed}),{...o,data:{ETag:o.headers.etag||"",Bucket:p,Key:d,Location:`http${this.opts.secure?"s":""}://${p}.${this.opts.endpoint}/${d}`,VersionID:o.headers["x-tos-version-id"],HashCrc64ecma:o.headers["x-tos-hash-crc64ecma"]}}})():(async()=>{let e=null,a=0;if(await Promise.all(Array.from({length:t.taskNum||1}).map(async()=>{for(;;){const n=a++;if(n>=f.length)return;const o=f[n];try{let e=Rt(t.srcBucket,t.srcKey);t.srcVersionId&&(e+="?versionId="+t.srcVersionId);const a=`bytes=${o.offset}-${o.offset+o.partSize-1}`,n={...t.headers,"x-tos-copy-source":e,"x-tos-copy-source-if-match":s,"x-tos-copy-source-range":a};o.partSize||delete n["x-tos-copy-source-range"];const{data:c}=await Oe.call(this,{bucket:p,key:d,uploadId:h,partNumber:o.partNumber,headers:n,trafficLimit:t.trafficLimit});if(i())throw new S("cancel resumableCopyObject");await O(o,{res:c})}catch(t){const a=t;if(Ne(a))throw a;if(i())throw new S("cancel resumableCopyObject");e||(e=a),await O(o,{err:a})}}})),e)throw e;const n=(T().parts_info||[]).map(t=>({eTag:t.etag,partNumber:t.part_number})),[o,c]=await F(Vt.call(this,{bucket:p,key:d,uploadId:h,parts:n}));if(o||!c)throw E({type:exports.ResumableCopyEventType.CompleteMultipartUploadFailed}),o;E({type:exports.ResumableCopyEventType.CompleteMultipartUploadSucceed}),B(C.completeMultipartUploadSucceed);const r=T().copy_source_object_info.hash_crc64ecma,l=c.data.HashCrc64ecma;if(this.opts.enableCRC&&r&&l&&r!==l)throw new w(`validate file crc64 failed. Expect crc64 ${r}, actual crc64 ${l}. Please try again.`);return await(async()=>{u.filePath&&await R(u.filePath).catch(t=>{console.warn("remove checkpoint file failure, you can remove it by hand.\n",`checkpoint file path: ${u.filePath}\n`,t.message)})})(),c})()}function Ne(t){return t instanceof S}async function Le(t){const e="string"==typeof t?{key:t}:t,a={};e.versionId&&(a.versionId=e.versionId);const n=U(null==e?void 0:e.headers),o=(null==e?void 0:e.response)||{};return Object.keys(o).forEach(t=>{const e=o[t];null!=e&&(a["response-"+t]=e)}),this._fetchObject(t,"GET",a,n,void 0,{axiosOpts:{responseType:"arraybuffer"}})}const Ue=["stream","buffer"];async function ze(t){const e="string"==typeof t?{key:t}:t,a=U(e.headers);e.headers=a;const n=e.dataType||"stream";e.dataType=n,function(t){let e="node",a=[];if(e="node",a=Ue,!a.includes(t))throw new w(`The value of \`dataType\` only supports \`${a.join(" | ")}\` in node environment`)}(n);const o={},i=(null==e?void 0:e.response)||{};if(Object.keys(i).forEach(t=>{const e=i[t];null!=e&&(o["response-"+t]=e)}),function(t,e,a){function n(t,a){null==e[t]&&(e[t]=a)}a.length&&a.forEach(e=>{const a=J[e];if(!a)throw new w(`\`${e}\` isn't in keys of \`requestQueryMap\``);const o=t[e];if(null==o)return;if("string"==typeof a)return n(a,""+o);if(Array.isArray(a))return n(a[0],a[1](o));const i=a(o);Object.entries(i).forEach(([t,e])=>{n(t,e)})})}(e,o,["versionId","process","saveBucket","saveObject","responseCacheControl","responseContentDisposition","responseContentEncoding","responseContentLanguage","responseContentType","responseExpires"]),Q(e,["ifMatch","ifModifiedSince","ifNoneMatch","ifUnmodifiedSince","ssecAlgorithm","ssecKey","ssecKeyMD5","range","trafficLimit"]),null==e.range&&(null!=e.rangeStart||null!=e.rangeEnd)){var c;const t=`bytes=${null!=e.rangeStart?""+e.rangeStart:""}-${null!=e.rangeEnd?""+e.rangeEnd:""}`;a.range=null!=(c=a.range)?c:t}let s=0,r=-1;const{dataTransferStatusChange:u,progress:l}=e,p=(t,e=0)=>{if(e<0)return;if(!u&&!l)return;s+=e,null==u||u({type:t,rwOnceBytes:e,consumedBytes:s,totalBytes:r});const a=r<0?0:0===r?t===exports.DataTransferType.Succeed?1:0:s/r;1===a?t===exports.DataTransferType.Succeed&&(null==l||l(a)):null==l||l(a)};p(exports.DataTransferType.Started);const[d,h]=await F(this._fetchObject(t,"GET",o,a,void 0,{axiosOpts:{responseType:"stream",onDownloadProgress:t=>{r=t.total,p(exports.DataTransferType.Rw,t.loaded-s)}}}));if(d||!h)throw p(exports.DataTransferType.Failed),d;let f=h.headers,m=h.data;r=+(f["content-length"]||0),q(m)&&(e.rateLimiter&&At(e.rateLimiter)&&(m=vt(m,e.rateLimiter)),m=ht(m,t=>p(exports.DataTransferType.Rw,t)),m.on("end",()=>p(exports.DataTransferType.Succeed)),"buffer"===n&&(m=await(async t=>{let e=Buffer.from([]);return new Promise((a,n)=>{t.on("data",t=>{e=Buffer.concat([e,t])}),t.on("end",()=>{a(e)}),t.on("error",t=>{n(t)})})})(m)));const y={...h,data:{content:m,etag:f.etag||"",lastModified:f["last-modified"]||"",hashCrc64ecma:f["x-tos-hash-crc64ecma"]||"",ReplicationStatus:f[Ct.HeaderReplicationStatus]}},g=Ot(f);return g&&(y.data.RestoreInfo=g),y}async function Fe(t){return new Promise(async(e,a)=>{const n=await ze.call(this,t),o=n.data.content,i=E(t.filePath);o.pipe(i),o.on("error",t=>i.destroy(t)),i.on("error",t=>a(t)),i.on("finish",()=>{const t={...n.data};delete t.content,e({...n,data:{...t}})})})}var Ge;(Ge=exports.DownloadEventType||(exports.DownloadEventType={}))[Ge.CreateTempFileSucceed=1]="CreateTempFileSucceed",Ge[Ge.CreateTempFileFailed=2]="CreateTempFileFailed",Ge[Ge.DownloadPartSucceed=3]="DownloadPartSucceed",Ge[Ge.DownloadPartFailed=4]="DownloadPartFailed",Ge[Ge.DownloadPartAborted=5]="DownloadPartAborted",Ge[Ge.RenameTempFileSucceed=6]="RenameTempFileSucceed",Ge[Ge.RenameTempFileFailed=7]="RenameTempFileFailed";const Ke=[403,404,405];async function qe(t){var e,a,n,o;const{cancelToken:i,versionId:c,enableSparseFile:s,writeStreamHighWaterMark:r}=t,u=()=>i&&!!i.reason;Dt(t.checkpoint);const l=await De.call(this,{bucket:t.bucket,key:t.key,versionId:c}),{data:p}=l,d=p.etag,h=null!=(e=p["x-tos-symlink-target-size"])?e:0,f="Symlink"===p["x-tos-object-type"]?+h:+p["content-length"],m=await(async()=>{if("string"==typeof t.checkpoint){const{checkpoint:e}=t;let a=null;try{a=await P(e)}catch(t){const e=t;if("ENOENT"!==e.code)throw e}const n=a?a.isDirectory():e.endsWith("/"),o=n?g.resolve(e,"@@checkpoint-file-placeholder@@"):e,i=g.dirname(o);return await D(i),n?{filePath:o,filePathIsPlaceholder:!0}:{filePath:o,filePathIsPlaceholder:!1,record:a?await nt(o):void 0}}return"object"==typeof t.checkpoint?{record:t.checkpoint}:{}})();await(async()=>{var t;if(null!=(t=m.record)&&t.object_info){var e;const{last_modified:t,object_size:a}=null==(e=m.record)?void 0:e.object_info;p["last-modified"]===t&&f===a||(console.warn(`The file has been modified since ${new Date(t)}, so the checkpoint file is invalid, and specified object will be downloaded again.`),delete m.record)}})();const y=t.partSize||(null==(a=m.record)?void 0:a.part_size)||20971520;m.record&&m.record.part_size!==y&&(console.warn("The partSize param does not equal the partSize in checkpoint file, so the checkpoint file is invalid, and specified object will be downloaded again."),delete m.record);let x=t.bucket||this.opts.bucket||"";const k=t.key,b=await(async()=>{let e=null;try{e=await P(t.filePath)}catch(t){const e=t;if("ENOENT"!==e.code)throw e}const a=(e?e.isDirectory():t.filePath.endsWith("/"))?g.resolve(t.filePath,k):t.filePath,n=g.dirname(a);return await D(n),a})(),[T,C]=await(async()=>{const e=t.tempFilePath?t.tempFilePath:b+".temp";let a=!0;try{await P(e)}catch(t){const e=t;if("ENOENT"!==e.code)throw e;a=!1}return[e,a]})();m.record&&(C||(console.warn("The temp file doesn't not exist so the checkpoint file is invalid, and specified object will be downloaded again."),delete m.record));let A=[];const O=function(t,e){const a=[];for(let n=0;;++n){const o=n*e,i=Math.min(e,t-o);if(a.push({offset:o,partSize:i,partNumber:n+1}),(n+1)*e>=t)break}return a}(f,y),M=((null==(n=m.record)?void 0:n.parts_info)||[]).filter(t=>t.is_completed).reduce((t,e)=>t+(e.range_end-e.range_start+1),0),_=(null==(o=m.record)?void 0:o.parts_info)||[],j=new Map;_.forEach(t=>j.set(t.part_number,t));const N=async()=>{const e=()=>({bucket:x,key:k,version_id:c,part_size:y,parts_info:_,file_info:{file_path:b,temp_file_path:T},object_info:{last_modified:p["last-modified"],etag:d,hash_crc64ecma:p["x-tos-hash-crc64ecma"]||"",object_size:f}}),a=e=>{if(!t.downloadEventChange)return;const a={bucket:x,versionId:c,key:k,filePath:b,...e};m.filePath&&(a.checkpointFile=m.filePath),t.downloadEventChange(a)};let n,o=M;!function(t){t[t.start=0]="start",t[t.downloadPartSucceed=1]="downloadPartSucceed",t[t.renameTempFileSucceed=2]="renameTempFileSucceed"}(n||(n={}));const i=a=>{t.progress&&(o===f&&a===n.downloadPartSucceed||t.progress(a===n.start&&0===f?0:f?o/f:1,e()))};let h=M;const{dataTransferStatusChange:C}=t,P=(t,e=0)=>{C&&(h+=e,null==C||C({type:t,rwOnceBytes:e,consumedBytes:h,totalBytes:f}))},N=at(async()=>{if(m.filePath){const t=JSON.stringify(e(),null,2),a=g.dirname(m.filePath);await D(a),await I(m.filePath,t,"utf-8")}}),L=async(t,e)=>{let c=j.get(t.partNumber);const s=t.offset,r=Math.min(t.offset+y-1,f-1);c||(c={part_number:t.partNumber,range_start:s,range_end:r,hash_crc64ecma:"",is_completed:!1},_.push(c),j.set(c.part_number,c)),e.err||(c.is_completed=!0,c.hash_crc64ecma=e.res.rangeHashCrc64ecma),await N();const u={partNumber:c.part_number,rangeStart:s,rangeEnd:r};if(e.err){const t=e.err;let n=exports.DownloadEventType.DownloadPartFailed;return t instanceof v&&Ke.includes(t.statusCode)&&(n=exports.DownloadEventType.DownloadPartAborted),void a({type:n,err:t,downloadPartInfo:u})}o+=u.rangeEnd-u.rangeStart+1,a({type:exports.DownloadEventType.DownloadPartSucceed,downloadPartInfo:u}),i(n.downloadPartSucceed)};if(m.record){x=m.record.bucket;const t=new Set((m.record.parts_info||[]).filter(t=>t.is_completed).map(t=>t.part_number));A=O.filter(e=>!t.has(e.partNumber))}else{try{if(await I(T,"",{flag:"w+"}),"win32"===process.platform&&s&&f>y){const{execFile:t}=require("child_process");await new Promise(e=>{t("fsutil",["sparse","setflag",T],(t,a,n)=>{t?console.warn(":",T,t,n):console.warn(":",T),e("")})})}}catch(t){const e=t;throw a({type:exports.DownloadEventType.CreateTempFileFailed,err:e}),e}var U;m.filePathIsPlaceholder&&(m.filePath=null==(U=m.filePath)?void 0:U.replace("@@checkpoint-file-placeholder@@",function(t,e,a){return`${t}_${e}.${a}.json`.replace(/[\\/]/g,"")}(x,k,c))),a({type:exports.DownloadEventType.CreateTempFileSucceed}),P(exports.DataTransferType.Started),A=O}i(n.start),0===f?await(async()=>{})():await(async()=>{let a=null,n=0;if(await Promise.all(Array.from({length:t.taskNum||1}).map(async()=>{for(;;){const e=n++;if(e>=A.length)return;const o=A[e];let i=0;try{const e=await ze.call(this,{bucket:x,key:k,versionId:c,headers:{"if-match":d,range:`bytes=${o.offset}-${Math.min(o.offset+o.partSize-1,f-1)}`},trafficLimit:t.trafficLimit,rateLimiter:t.rateLimiter,dataTransferStatusChange(t){t.type===exports.DataTransferType.Rw&&(u()||(i+=t.rwOnceBytes,P(exports.DataTransferType.Rw,t.rwOnceBytes)))}});let a=e.data.content;const n=new mt;if(this.opts.enableCRC&&(a=Et(a,n)),await new Promise((t,e)=>{const n=E(T,{start:o.offset,flags:"r+",highWaterMark:r});let i=!1,c=null;n.on("close",()=>{i?e(c):t(void 0)}),n.on("error",t=>{i=!0,c=t}),a.pipe(n),a.on("error",t=>n.destroy(t)),a.on("data",(function t(){u()&&(e(new S("cancel downloadFile")),n.end(),a.unpipe(n),a.off("data",t))}))}),u())throw new S("cancel downloadFile");await L(o,{res:{...e.data,rangeHashCrc64ecma:n.getCrc64()}})}catch(t){const e=t;if(h-=i,i=0,V(e))throw e;if(u())throw new S("cancel downloadFile");a||(a=e),await L(o,{err:e})}}})),a)throw a;const o=l.data["x-tos-hash-crc64ecma"];if(this.opts.enableCRC&&o){const t=function(t){var e,a;let n="0";const o=null!=(e=null==(a=t.parts_info)||null==a.sort?void 0:a.sort((t,e)=>t.part_number-e.part_number))?e:[];for(const t of o)n=yt(n,t.hash_crc64ecma,t.range_end-t.range_start+1);return n}(e());if(t!==o)throw new w(`validate file crc64 failed. Expect crc64 ${o}, actual crc64 ${t}. Please try again.`)}})();try{"function"==typeof t.customRenameFileAfterDownloadCompleted?await t.customRenameFileAfterDownloadCompleted(T,b):await B(T,b)}catch(t){const e=t;throw a({type:exports.DownloadEventType.RenameTempFileFailed,err:e}),P(exports.DataTransferType.Failed),e}return a({type:exports.DownloadEventType.RenameTempFileSucceed}),i(n.renameTempFileSucceed),P(exports.DataTransferType.Succeed),await(async()=>{m.filePath&&await R(m.filePath).catch(t=>{console.warn("remove checkpoint file failure, you can remove it by hand.\n",`checkpoint file path: ${m.filePath}\n`,t.message)})})(),l};try{return await N()}finally{}}function $e(t){return!t||80===t||443===t}const Ve="request";class He{constructor(t,e){this.options=void 0,this.credentials=void 0,this.signature=(t,e,a)=>{a||(a=this.credentials);const n=[],o=this.credentialString(t.datetime);return n.push(this.options.algorithm+" Credential="+a.GetAccessKey()+"/"+o),n.push("SignedHeaders="+this.signedHeaders(t)),n.push("Signature="+this.authorization(t,a,0)),n.join(", ")},this.signatureHeader=(t,e,a)=>{t.datetime=this.getDateTime();const n=new Map;t.headers||(t.headers={}),t.headers.host=""+t.host,$e(t.port)||(t.headers.host+=":"+t.port),t.endpoints&&(t.headers.host=`${this.options.bucket}.${t.endpoints}`),n.set("host",t.headers.host),n.set("x-tos-date",t.datetime),n.set("x-tos-content-sha256",this.hexEncodedBodyHash()),this.options.securityToken&&n.set("x-tos-security-token",this.options.securityToken),n.forEach((e,a)=>{a.startsWith("x-tos")&&(t.headers[a]=e)}),t.path=this.getEncodePath(t.path);const o=this.signature(t,0,a);return n.set("authorization",o),n},this.gnrCopySig=(t,e)=>({key:"",value:""}),this.getSignature=(t,e)=>({key:"",value:""}),this.getSignatureQuery=(t,e)=>{t.datetime=this.getDateTime(),t.headers||(t.headers={}),t.headers.host=""+t.host,$e(t.port)||(t.headers.host+=":"+t.port),t.path=this.getEncodePath(t.path),t.endpoints&&(t.headers.host=`${this.options.bucket}.${t.endpoints}`),t.headers["X-Tos-Date"]=t.datetime;const a=this.credentialString(t.datetime),n={...t.query||{},"X-Tos-Algorithm":this.options.algorithm,"X-Tos-Content-Sha256":this.hexEncodedBodyHash(),"X-Tos-Credential":this.credentials.GetAccessKey()+"/"+a,"X-Tos-Date":t.datetime,"X-Tos-Expires":""+e,"X-Tos-SignedHeaders":this.signedHeaders(t)};return this.options.securityToken&&(n["X-Tos-Security-Token"]=this.options.securityToken),t.query=L(n),n["X-Tos-Signature"]=this.authorization(t,this.credentials,e),n},this.getSignaturePolicyQuery=(t,e)=>{t.datetime=this.getDateTime();const a=this.credentialString(t.datetime),n={"X-Tos-Algorithm":this.options.algorithm,"X-Tos-Credential":this.credentials.GetAccessKey()+"/"+a,"X-Tos-Date":t.datetime,"X-Tos-Expires":""+e,"X-Tos-Policy":Gt(Ft(JSON.stringify(t.policy),"utf-8"),"base64")};return this.options.securityToken&&(n["X-Tos-Security-Token"]=this.options.securityToken),t.query=L(n),n["X-Tos-Signature"]=this.authorization(t,this.credentials,e),n},this.hexEncodedBodyHash=()=>"UNSIGNED-PAYLOAD",this.authorization=(t,e,a)=>{if(!t.datetime)return"";const n=this.getSigningKey(e,t.datetime.substr(0,8));return Lt(n,this.stringToSign(t.datetime,t),"hex")},this.getDateTime=()=>new Date((new Date).toUTCString()).toISOString().replace(/\..+/,"").replace(/-/g,"").replace(/:/g,"")+"Z",this.credentialString=t=>this.createScope(t.substr(0,8),this.options.region,this.options.serviceName),this.createScope=(t,e,a)=>[t.substr(0,8),e,a,Ve].join("/"),this.getSigningKey=(t,e)=>{const a=Lt(t.GetSecretKey(),e),n=Lt(a,this.options.region),o=Lt(n,this.options.serviceName);return Lt(o,Ve)},this.stringToSign=(t,e)=>{if(!this.options.algorithm)return"";const a=[];a.push(this.options.algorithm),a.push(t),a.push(this.credentialString(t));const n="policy"in e?this.canonicalStringPolicy(e):this.canonicalString(e);return a.push(this.hexEncodedHash(n)),a.join("\n")},this.hexEncodedHash=t=>Ut(t,"hex"),this.canonicalString=t=>{const e=[];return e.push(t.method),e.push(t.path),e.push(this.getEncodePath(t.query,!1)),e.push(this.canonicalHeaders(t)+"\n"),e.push(this.signedHeaders(t)),e.push(this.hexEncodedBodyHash()),e.join("\n")},this.canonicalStringPolicy=t=>{const e=[];return e.push(this.getEncodePath(t.query,!1)),e.push(this.hexEncodedBodyHash()),e.join("\n")},this.canonicalHeaders=t=>{const e=[],a=Je(t.headers);for(let n of a){const a=t.headers[n];n=n.toLowerCase(),e.push(n+":"+this.canonicalHeaderValues(a.toString()))}return e.join("\n")},this.canonicalHeaderValues=t=>t.replace(/\s+/g," ").replace(/^\s+|\s+$/g,""),this.signedHeaders=t=>{const e=[],a=Je(t.headers);for(let t of a)t=t.toLowerCase(),e.push(t);return e.sort().join(";")},this.options=t,this.credentials=e}getEncodePath(t,e=!0){if(!t)return"";let a=t;return e&&(a=t.replace(/%2F/g,"/")),a=a.replace(/\(/g,"%28"),a=a.replace(/\)/g,"%29"),a=a.replace(/!/g,"%21"),a=a.replace(/\*/g,"%2A"),a=a.replace(/\'/g,"%27"),a}}class We{constructor(t,e,a){this.securityToken=void 0,this.secretAccessKey=void 0,this.accessKeyId=void 0,this.accessKeyId=a,this.secretAccessKey=e,this.securityToken=t}GetAccessKey(){return this.accessKeyId}GetSecretKey(){return this.secretAccessKey}}function Je(t){const e=[];return Object.keys(t||{}).forEach(a=>{("host"===a||a.startsWith("x-tos-"))&&null!=t[a]&&e.push(a)}),e.sort()}function Qe(t){const{tosOpts:e,...a}=t,n=new(e.isHttps?b.Agent:k.Agent)({...a,keepAlive:!0,rejectUnauthorized:e.enableVerifySSL,timeout:e.idleConnectionTime});n.maxFreeSockets=Infinity,n.maxTotalSockets=e.maxConnections;const o=n.createConnection;return n.createConnection=function(...t){const a=o.call(this,...t);let n=!1,i=!1,c=null;return process.nextTick(()=>{i||(c=setTimeout(()=>{n=!0},e.connectionTimeout))}),a.on("connect",()=>{i=!0,c&&clearTimeout(c),n&&a.destroy(new Error("Connect timeout"))}),a},n}class Xe{constructor(t){this.opts=void 0,this.axiosInst=void 0,this.userAgent=void 0,this.httpAgent=void 0,this.httpsAgent=void 0,this.getObjectPath=t=>{const e="string"!=typeof t&&t.bucket||this.opts.bucket,a="string"==typeof t?t:t.key;if(!e)throw new w("Must provide bucket param");return`/${e}/${encodeURIComponent(a)}`},this.setObjectContentTypeHeader=(t,e)=>{if(null!=e["content-type"])return;let a="application/octet-stream";const n=(t=>"string"==typeof t?t:t.key)(t);this.opts.autoRecognizeContentType&&(a=function(t){const e=t.lastIndexOf(".");if(e<=0)return;const a=t.slice(e+1).toLowerCase();return pt[a]}(n)||a),a&&(e["content-type"]=a)},this.getNormalDataFromError=Y,this.opts=this.normalizeOpts(t),this.httpAgent=Qe({tosOpts:{...this.opts,isHttps:!1}}),this.httpsAgent=Qe({tosOpts:{...this.opts,isHttps:!this.opts.proxyHost}}),this.userAgent=this.getUserAgent(),this.axiosInst=(t=>{const e=a.create();e.defaults.auth=void 0,e.defaults.responseType="json",e.defaults.params=void 0,e.defaults.headers={},e.defaults.withCredentials=!1,e.defaults.maxContentLength=-1,e.defaults.maxBodyLength=-1,e.defaults.maxRedirects=0,e.defaults.validateStatus=function(t){return t>=200&&t<300},e.defaults.decompress=!1,e.defaults.transitional={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};const o=t=>{var e;return t.headers=t.headers||t.header||(null==t||null==(e=t.response)?void 0:e.headers)||{},t};function i(t){Object.entries(t).forEach(([e,a])=>{const[n,o]=function(t){try{return[null,decodeURI(a)]}catch(t){return[t,null]}}();if(n||null==o||o===a)return;let i=[];const c=(""+a).match(/./gu),s=o.match(/./gu);for(let t=0,e=0;t<s.length;){const a=s[t];if(a===c[e]){i.push(a),++t,++e;continue}const n=encodeURIComponent(a);a.length>1||a.charCodeAt(0)>=128?i.push(a):i.push(n),++t,e+=n.length}t[e]=i.join("")})}return e.interceptors.response.use(o,t=>(o(t),Promise.reject(t))),e.interceptors.response.use(t=>t.headers?(i(t.headers),t):t,async t=>{var e;if(!a.isAxiosError(t))return Promise.reject(t);const n=null==(e=t.response)?void 0:e.headers;return n?(i(n),Promise.reject(t)):Promise.reject(t)}),e.interceptors.response.use(void 0,async a=>{var o;const{config:i}=a;if(!i)return Promise.reject(a);i.__retryConfig__||(i.__retryConfig__={});const c=i.__retryConfig__,s=null!=(o=c.retryCount)?o:0;let r=i.data;const u=(()=>{if(i.data&&i.data instanceof n.Readable){const t=null==c.makeRetryStream?void 0:c.makeRetryStream();if(!t)return!1;r=t}return!0})();if(!((function(t){var e;return!t.response&&Boolean(t.code)||t.response&&!(null!=(e=t.response.headers)&&e["x-tos-request-id"])}(a)||function(t){if(!t.response)return!1;const{status:e}=t.response;return 429===e||408===e||e>=500}(a))&&s<t&&u))return Promise.reject(a);const l=i.__retrySignature__;if(l){const{signOpt:t,sigInst:e}=l;e.signatureHeader(t).forEach((t,e)=>{i.headers[e]=t})}O("retryConfig: ",i);const p={...i,data:r,__retryConfig__:{...c,retryCount:s+1}};return null==c.beforeRetry||c.beforeRetry(),e(p)}),e})(this.opts.maxRetryCount)}normalizeOpts(t){var e;["accessKeyId","accessKeySecret","stsToken","region","endpoint"].forEach(e=>{const a=t[e];"string"==typeof a&&(t[e]=a.trim())});const a=["accessKeyId","accessKeySecret","region"].filter(e=>!t[e]).join(", ");if(a)throw new w(`lack params: ${a}.`);const n=t.endpoint||`tos-${t.region}.volces.com`;if(!n)throw new w("the value of param region is invalid, correct values are cn-beijing, cn-nantong etc.");if(["tos-s3-cn-beijing.volces.com","tos-s3-cn-guangzhou.volces.com","tos-s3-cn-shanghai.volces.com","tos-s3-ap-southeast-1.volces.com"].includes(n))throw new w("do not support s3 endpoint, please use tos endpoint.");const o=null==t.secure||!!t.secure,i=(t,e)=>null==t?e:t;return{...t,endpoint:n,secure:o,enableVerifySSL:i(t.enableVerifySSL,!0),autoRecognizeContentType:i(t.autoRecognizeContentType,!0),requestTimeout:i(t.requestTimeout,12e4),connectionTimeout:i(t.connectionTimeout,1e4),maxConnections:i(t.maxConnections,1024),idleConnectionTime:i(t.idleConnectionTime,3e4),maxRetryCount:i(t.maxRetryCount,3),enableCRC:null!=(e=t.enableCRC)&&e,requestAdapter:void 0}}getUserAgent(){const t=(()=>{const t=T.type();return{Linux:"linux",Darwin:"darwin",Windows_NT:"windows"}[t]||t})(),e=process.version.replace("v","");return[`ve-tos-nodejs-sdk/v2.9.0 (${t}/${process.arch};nodejs${e})`,(()=>{const{userAgentProductName:t,userAgentSoftName:e,userAgentSoftVersion:a}=this.opts;let n=Object.entries(this.opts.userAgentCustomizedKeyValues||{}).map(([t,e])=>`${t}/${e}`).join(";");return n=n?`(${n})`:"",t||e||a||n?[[t,e,a].map(t=>t||"undefined").join("/"),n].filter(Boolean).join(" "):""})()].filter(Boolean).join(" -- ")}async fetch(t,e,n,o,i,c){const s=(null==c?void 0:c.handleResponse)||(t=>t.data);if(i&&(null==c?void 0:c.needMd5)){const t=zt(JSON.stringify(i),"base64");o["content-md5"]=t}const[r,u]=(()=>null!=c&&c.subdomainBucket&&this.opts.forcePathStyle?[this.opts.endpoint,`/${c.subdomainBucket}${e}`]:null!=c&&c.subdomainBucket&&!this.opts.isCustomDomain?/^(\d|:)/.test(this.opts.endpoint)?[this.opts.endpoint,`/${c.subdomainBucket}${e}`]:[`${null==c?void 0:c.subdomainBucket}.${this.opts.endpoint}`,e]:[this.opts.endpoint,e])();e=u,o=(t=>{const e={};return Object.entries(t).forEach(([t,a])=>{e[t]=(""+a).match(/./gu).map(t=>t.length>1||t.charCodeAt(0)>=128?encodeURIComponent(t):t).join("")}),e})(o);const l={endpoints:void 0,bucket:"",method:t,headers:{...o},path:e,query:L(n),host:r},p=new We(this.opts.stsToken,this.opts.accessKeySecret,this.opts.accessKeyId),d=new He({algorithm:"TOS4-HMAC-SHA256",region:this.opts.region,serviceName:(null==c?void 0:c.serviceName)||"tos",bucket:"",securityToken:this.opts.stsToken},p),h=d.signatureHeader(l),f={...o},m={method:t,baseURL:`http${this.opts.secure?"s":""}://${r}`,url:e,params:n,headers:f,data:i||""};h.forEach((t,e)=>{m.headers[e]=t});const y=z(this.opts.proxy);if(null!=y&&y.url&&!this.opts.proxyHost)m.baseURL=y.url,null!=y&&y.needProxyParams&&(m.params["x-proxy-tos-host"]=r,delete f.host);else if(this.opts.proxyHost){if(!this.opts.proxyPort)throw new w("The `proxyPort` is required if `proxyHost` is truly.");m.proxy={host:this.opts.proxyHost,port:this.opts.proxyPort,protocol:"http"}}f["user-agent"]=this.userAgent,this.opts.requestTimeout>0&&Infinity!==this.opts.requestTimeout&&(m.timeout=this.opts.requestTimeout),m.httpAgent=this.httpAgent,m.httpsAgent=this.httpsAgent;try{const t={...m};delete t.httpAgent,delete t.httpsAgent,O("reqOpts: ",t);const e=await this.axiosInst({maxBodyLength:Infinity,maxContentLength:Infinity,adapter:this.opts.requestAdapter,...m,...(null==c?void 0:c.axiosOpts)||{},__retrySignature__:{signOpt:l,sigInst:d}});return{data:s(e),statusCode:e.status,headers:e.headers,requestId:e.headers["x-tos-request-id"],id2:e.headers["x-tos-id-2"]}}catch(t){var g,x,k,b;if(a.isAxiosError(t)&&(null!=(g=t.response)&&null!=(x=g.headers)&&x["x-tos-request-id"]||null!=(k=t.response)&&null!=(b=k.data)&&b.requestId)){const e=t.response;throw O("TosServerError response: ",e),new v(e)}throw O("err: ",t),t}}async fetchBucket(t,e,a,n,o,i){const c=t||this.opts.bucket;if(!c)throw new w("Must provide bucket param");return st(c,this.opts.isCustomDomain),this.fetch(e,"/",a,n,o,{...i,subdomainBucket:c})}async _fetchObject(t,e,a,n,o,i){const c="string"!=typeof t&&t.bucket||this.opts.bucket,s="string"==typeof t?t:t.key;if(!c)throw new w("Must provide bucket param");return st(c,this.opts.isCustomDomain),Bt(s),this.fetch(e,"/"+encodeURIComponent(s),a,n,o,{...i,subdomainBucket:c})}getSignatureQuery(t){const e=new We(this.opts.stsToken,this.opts.accessKeySecret,this.opts.accessKeyId),a=new He({algorithm:"TOS4-HMAC-SHA256",region:this.opts.endpoint,serviceName:"tos",bucket:t.bucket,securityToken:this.opts.stsToken},e);return"policy"in t?a.getSignaturePolicyQuery({policy:t.policy},t.expires):a.getSignatureQuery({method:t.method,path:t.path,endpoints:t.subdomain?t.endpoint:void 0,host:t.endpoint,query:t.query},t.expires)}normalizeBucketInput(t){return"string"==typeof t?{bucket:t}:t}normalizeObjectInput(t){return"string"==typeof t?{key:t}:t}}async function Ye(t={}){const{...e}=t,a=await this.fetchBucket(t.bucket,"GET",j(e),{}),n=M(a.data);return n("CommonPrefixes"),n("Contents"),n("Versions"),n("DeleteMarkers"),a}async function Ze(t={}){const{...e}=t,a=await this.fetchBucket(t.bucket,"GET",j({versions:"",...e}),{}),n=M(a.data);return n("CommonPrefixes"),n("Versions"),n("DeleteMarkers"),a}async function ta(t={}){const{listOnlyOnce:e=!1}=t;let a;if(t.maxKeys||(t.maxKeys=1e3),e)a=await ea.call(this,t);else{const e=t.maxKeys;let n={...t,maxKeys:e};for(;;){const t=await ea.call(this,n);if(null==a?a=t:(a={...t,data:a.data},a.data.KeyCount+=t.data.KeyCount,a.data.IsTruncated=t.data.IsTruncated,a.data.NextContinuationToken=t.data.NextContinuationToken,a.data.Contents=a.data.Contents.concat(t.data.Contents),a.data.CommonPrefixes=a.data.CommonPrefixes.concat(t.data.CommonPrefixes)),!t.data.IsTruncated||a.data.KeyCount>=e)break;n.continuationToken=t.data.NextContinuationToken,n.maxKeys=n.maxKeys-t.data.KeyCount}}return a}async function ea(t){const{...e}=t,a=await this.fetchBucket(t.bucket,"GET",{"list-type":2,...j(e)},{}),n=M(a.data);return n("CommonPrefixes"),n("Contents"),a}class aa extends Xe{modifyAxiosInst(){this.axiosInst.interceptors.request.use(t=>{const e=t.headers||{};return delete e.authorization,e.host=this.parsedPolicyUrlVal.host,t.baseURL=this.parsedPolicyUrlVal.origin,t.paramsSerializer=t=>{const e=X(t);return[this.parsedPolicyUrlVal.search,e].filter(t=>t.trim()).join("&")},t})}constructor(t){super({...t,bucket:"fake-bucket",region:"fake-region",accessKeyId:"fake-accessKeyId",accessKeySecret:"fake-accessKeySecret",endpoint:"fake-endpoint.com"}),this.shareLinkClientOpts=void 0,this.parsedPolicyUrlVal=void 0,this.headObject=De,this.getObjectV2=ze,this.listObjects=Ye,this.listObjectsType2=ta,this.listObjectVersions=Ze,this.downloadFile=qe,this.shareLinkClientOpts=t,this.parsedPolicyUrlVal=this.initParsedPolicyUrlVal(),this.modifyAxiosInst()}initParsedPolicyUrlVal(){const t=this.shareLinkClientOpts.policyUrl.match(/(https?:\/\/(?:[^@]+@)?([^/?]+))[^?]*\?(.+)/);if(!t)throw new w("the `policyUrl` param is invalid");return{origin:t[1],host:t[2],search:t[3]}}}async function na(t={}){const e={};(null==t?void 0:t.projectName)&&Q({...t,headers:e},["projectName"]);const a=await this.fetch("GET","/",{},e);return M(a.data)("Buckets"),a}async function oa(t){const e=t.bucket||this.opts.bucket;if(e){if(e.length<3||e.length>63)throw new w("invalid bucket name, the length must be [3, 63]");if(!/^([a-z]|-|\d)+$/.test(e))throw new w("invalid bucket name, the character set is illegal");if(/^-/.test(e)||/-$/.test(e))throw new w("invalid bucket name, the bucket name can be neither starting with '-' nor ending with '-'")}const a=t.headers=U(t.headers);return Q(t,["acl","grantFullControl","grantRead","grantReadAcp","grantWrite","grantWriteAcp","storageClass","azRedundancy","bucketType","tagging"]),(null==t?void 0:t.projectName)&&Q(t,["projectName"]),await this.fetchBucket(t.bucket,"PUT",{},a)}async function ia(t){return this.fetchBucket(t,"DELETE",{},{})}async function ca(t){return this.fetchBucket(t,"HEAD",{},{},void 0,{handleResponse:t=>({...t.headers,ProjectName:t.headers[Ct.HeaderProjectName]})})}async function sa(t){if(!t)throw new w("input is required");const{bucket:e}=t;st(e,this.opts.isCustomDomain);try{return 200===(await ca.call(this,e)).statusCode}catch(t){if(t instanceof v&&"0006-00000001"===t.ec)return!1;throw t}}async function ra(t){const{bucket:e,storageClass:a}=t;return this.fetchBucket(e,"PUT",{storageClass:""},{"x-tos-storage-class":a})}async function ua(t){const{bucket:e}=t;return this.fetchBucket(e,"GET",{bucketInfo:""},{})}async function la(t){const e={};return t.acl&&(e["x-tos-acl"]=t.acl),await this.fetchBucket(t.bucket,"PUT",{acl:""},e,t.aclBody,{needMd5:!0})}async function pa(t){const e=await this.fetchBucket(t,"GET",{acl:""},{});return M(e.data)("Grants"),e}async function da(t){const{bucket:e,TLS:a}=t;return await this.fetchBucket(e,"PUT",{httpsConfig:""},{},{TLS:a})}async function ha(t){return await this.fetchBucket(t,"GET",{httpsConfig:""},{})}async function fa(t){return ma.call(this,t)}async function ma(t){const e=(t=this.normalizeObjectInput(t)).headers=U(t.headers);Q(t,["contentLength","contentMD5","contentSHA256","cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","acl","grantFullControl","grantRead","grantReadAcp","grantWrite","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","serverSideEncryption","serverSideDataEncryption","meta","websiteRedirectLocation","storageClass","trafficLimit","callback","callbackVar","forbidOverwrite","ifMatch"]),this.setObjectContentTypeHeader(t,e);const a=Pt(t.body,e),n=null!=a;n||!t.dataTransferStatusChange&&!t.progress||console.warn("Don't get totalSize of putObject's body, the `dataTransferStatusChange` and `progress` callback will not trigger. You can use `putObjectFromFile` instead");let o=0;const{dataTransferStatusChange:i,progress:c}=t,s=(t,e=0)=>{if(!n||e<0)return;if(!i&&!c)return;o+=e,null==i||i({type:t,rwOnceBytes:e,consumedBytes:o,totalBytes:a});const s=0===a?t===exports.DataTransferType.Succeed?1:0:o/a;1===s?t===exports.DataTransferType.Succeed&&(null==c||c(s)):null==c||c(s)},r=await It({body:t.body,dataTransferCallback:t=>s(exports.DataTransferType.Rw,t),makeRetryStream:t.makeRetryStream,enableCRC:this.opts.enableCRC,rateLimiter:t.rateLimiter});s(exports.DataTransferType.Started);const[u,l]=await F((async()=>{const a=await this._fetchObject(t,"PUT",{},e,r.body||"",{handleResponse:e=>{var a;const n={...e.headers};return null!=(a=t)&&a.callback&&e.data&&(n.CallbackResult=""+JSON.stringify(e.data)),n},axiosOpts:{__retryConfig__:{beforeRetry:()=>{o=0,null==r.beforeRetry||r.beforeRetry()},makeRetryStream:r.makeRetryStream},onUploadProgress:t=>{s(exports.DataTransferType.Rw,t.loaded-o)}}});return this.opts.enableCRC&&r.crc&&Z(r.crc,a.headers),a})());if(u||!l)throw s(exports.DataTransferType.Failed),u;return s(exports.DataTransferType.Succeed),l}async function ya(t){const e=U(t.headers);if(!e["content-length"]){const a=await P(t.filePath);e["content-length"]=""+a.size}const a=ot(()=>C(t.filePath));try{return await ma.call(this,{...t,body:a.make(),headers:e,makeRetryStream:a.make})}catch(t){throw it(a.getLastStream(),t),t}}async function ga(t){const e=t.headers=U(t.headers);return Q(t,["acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","meta","storageClass"]),await this._fetchObject(t,"POST",{fetch:""},e,{URL:t.url,IgnoreSameKey:t.ignoreSameKey,ContentMD5:t.contentMD5},{needMd5:!0})}async function xa(t){const e=t.headers=U(t.headers);return Q(t,["acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","meta","storageClass"]),await this._fetchObject(t,"POST",{fetchTask:""},e,{URL:t.url,IgnoreSameKey:t.ignoreSameKey,ContentMD5:t.contentMD5,Object:t.key},{needMd5:!0})}async function ka(t){const e=await this.fetchBucket(t.bucket,"GET",{fetchTask:"",taskId:t.taskId},{},{},{needMd5:!0});return e.data.Task&&(e.data.Task.Meta=e.data.Task.UserMeta),e}function ba(t){Bt(t);const e="string"==typeof t?{key:t}:t,a=e.alternativeEndpoint||this.opts.endpoint,n=!e.alternativeEndpoint&&!e.isCustomDomain,o=e.bucket||this.opts.bucket||"";if(n&&!o)throw new w("Must provide bucket param");const[i,c,s]=(()=>{const t=encodeURIComponent(e.key),i=e.key.split("/").map(t=>encodeURIComponent(t)).join("/");return n?[`${o}.${a}`,"/"+i,"/"+t]:[a,"/"+i,"/"+t]})(),r=e.query||{},u=(t,e)=>{null==r[t]&&null!=e&&(r[t]=e)},l=e.response||{};Object.keys(l).forEach(t=>{const e=t,a=j(e);u("response-"+a,l[e])}),e.versionId&&u("versionId",e.versionId);const p=this.getSignatureQuery({bucket:o,method:e.method||"GET",path:s,endpoint:a,subdomain:n,expires:e.expires||1800,query:r}),d=z(this.opts.proxy);let h=`http${this.opts.secure?"s":""}://${i}`;return null!=d&&d.url&&(h=d.url.replace(/\/+$/g,""),null!=d&&d.needProxyParams&&(p["x-proxy-tos-host"]=i)),`${h}${c}?${Object.keys(p).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(p[t])}`).join("&")}`}async function Ta(t){if(!t)throw new w("input is required");try{return 200===(await De.call(this,{bucket:t.bucket,key:t.key,versionId:t.versionId})).statusCode}catch(t){if(t instanceof v&&404===t.statusCode)return!1;throw t}}async function va(t){const e="string"==typeof t?{key:t}:t,a={};return e.versionId&&(a.versionId=e.versionId),e.skipTrash&&(a.skipTrash=e.skipTrash),e.recursive&&(a.recursive=e.recursive),await this._fetchObject(t,"DELETE",a,{},{},{handleResponse:t=>t.headers})}async function wa(t){return t.headers=t.headers||{},Q(t,["recursiveMkdir","forbidOverwrite"]),this._fetchObject(t,"PUT",{rename:"",name:t.newKey},t.headers,"")}async function Sa(t){const e={Quiet:t.quiet,Objects:t.objects.map(t=>({Key:t.key,VersionId:t.versionId}))},a={delete:""};t.skipTrash&&(a.skipTrash=t.skipTrash),t.recursive&&(a.recursive=t.recursive);const n=await this.fetchBucket(t.bucket,"POST",a,{},e),o=M(n.data);return o("Deleted"),o("Error"),n}async function Ea(t){const e="string"==typeof t?{key:t}:t,a={acl:""};e.versionId&&(a.versionId=e.versionId);const n=await this._fetchObject(t,"GET",a,{});return M(n.data)("Grants"),n}async function Ca(t){const e=t.headers=U(t.headers),a={acl:""};return t.versionId&&(a.versionId=t.versionId),Q(t,["acl"]),this._fetchObject(t,"PUT",a,e,t.aclBody)}async function Ba(t){return this._fetchObject(t,"DELETE",{uploadId:t.uploadId},{})}async function Pa(t={}){const{...e}=t,a=await this.fetchBucket(t.bucket,"GET",{uploads:"",...j(e)},{}),n=M(a.data);return n("Uploads"),n("CommonPrefixes"),a}async function Ia(t){const e=t=this.normalizeObjectInput(t),a=t.headers=U(t.headers);Q(t,["contentLength","cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","meta","websiteRedirectLocation","storageClass","trafficLimit"]),this.setObjectContentTypeHeader(t,a);const n=Pt(t.body,a),o=null!=n;if(!o)throw new w("appendObject needs to know the content length in advance");if(a["content-length"]=a["content-length"]||""+n,this.opts.enableCRC&&0!==t.offset&&!t.preHashCrc64ecma)throw new w("must provide preHashCrc64ecma if enableCRC is true and offset is non-zero");let i=0;const{dataTransferStatusChange:c,progress:s}=t,r=(t,e=0)=>{if(!o||e<0)return;if(!c&&!s)return;i+=e,null==c||c({type:t,rwOnceBytes:e,consumedBytes:i,totalBytes:n});const a=0===n?t===exports.DataTransferType.Succeed?1:0:i/n;1===a?t===exports.DataTransferType.Succeed&&(null==s||s(a)):null==s||s(a)},u=await It({body:t.body,dataTransferCallback:t=>r(exports.DataTransferType.Rw,t),makeRetryStream:void 0,enableCRC:this.opts.enableCRC,rateLimiter:t.rateLimiter});r(exports.DataTransferType.Started);const[l,p]=await F((async()=>{const o=await this._fetchObject(t,"POST",{append:"",offset:e.offset},a,u.body||"",{handleResponse:t=>({...t.headers,nextAppendOffset:+t.headers["x-tos-next-append-offset"],hashCrc64ecma:t.headers["x-tos-hash-crc64ecma"]}),axiosOpts:{__retryConfig__:{beforeRetry:()=>{i=0,null==u.beforeRetry||u.beforeRetry()},makeRetryStream:u.makeRetryStream},onUploadProgress:t=>{r(exports.DataTransferType.Rw,t.loaded-i)}}});return this.opts.enableCRC&&u.crc&&Z(yt(e.preHashCrc64ecma||"0",u.crc.getCrc64(),n),o.headers),o})());if(l||!p)throw r(exports.DataTransferType.Failed),l;return r(exports.DataTransferType.Succeed),p}async function Ra(t){const e="string"==typeof t?{key:t}:t,a=e.headers=U(e.headers);Q(e,["cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","meta"]);const n={metadata:""};return e.versionId&&(n.versionId=e.versionId),this._fetchObject(t,"POST",n,a)}async function Aa(t){Bt(t),t=this.normalizeObjectInput(t);const{expiresIn:e=3600,key:a}=t,n=t.bucket||this.opts.bucket,o={...t.fields},i=[...t.conditions||[]];if(!n)throw new w("Must provide bucket param");const c=this.opts.accessKeySecret,s=new Date,r=Da({date:new Date(s.valueOf()+1e3*e),type:"ISO"}),u=Da(),l=u.substring(0,8),p="tos",d="request",h=Lt(c,l),f=Lt(h,this.opts.region),m=Lt(f,p),y=Lt(m,d),g={key:a,"x-tos-algorithm":"TOS4-HMAC-SHA256","x-tos-date":u,"x-tos-credential":[this.opts.accessKeyId,l,this.opts.region,p,d].join("/")};this.opts.stsToken&&(g["x-tos-security-token"]=this.opts.stsToken),i.push({bucket:n}),Object.entries(g).forEach(([t,e])=>{o[t]=e}),Object.entries(o).forEach(([t,e])=>{i.push({[t]:""+e})});const x=JSON.stringify({expiration:r,conditions:i}),k=Gt(Ft(x,"utf-8"),"base64"),b=Lt(y,k,"hex");return o.policy=k,o["x-tos-signature"]=b,o}function Da(t){const{date:e=new Date,type:a="Z"}=t||{};return"ISO"===a?e.toISOString():e.toISOString().replace(/\..+/,"").replace(/-/g,"").replace(/:/g,"")+"Z"}const Oa={getBucketCustomDomain:!0,getBucketIntelligenttiering:!0,getBucketInventory:!0,listBucketInventory:!0,getBucketMirrorBack:!0,getBucketNotification:!0,getBucketPolicy:!0,getBucketRealTimeLog:!0,getBucketReplication:!0,getBucketTagging:!0,getBucketWebsite:!0};function Ma(t,e){const{enableCatchEmptyServerError:a,methodKey:n,defaultResponse:o}=e;if(t instanceof v)if(a){if(404===t.statusCode)return Y(o,t)}else if(void 0===a&&404===t.statusCode&&Oa[n])return Y(o,t);throw t}async function _a(t){return!this.opts.enableOptimizeMethodBehavior&&void 0!==this.opts.enableOptimizeMethodBehavior||t.policy.Statement.length?await this.fetchBucket(t.bucket,"PUT",{policy:""},{},t.policy,{needMd5:!0}):Na.call(this,t.bucket)}async function ja(t){try{const e=await this.fetchBucket(t,"GET",{policy:""},{});return e.data.Statement.forEach(t=>{const e=M(t);Object.keys(t.Condition||{}).forEach(a=>{Object.keys(t.Condition[a]).forEach(t=>{e(`Condition["${a}"]["${t}"]`)})})}),e}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketPolicy",defaultResponse:{Statement:[],Version:"2012-10-17"}})}}async function Na(t){return this.fetchBucket(t,"DELETE",{policy:""},{})}async function La(t){return this.fetchBucket(t,"GET",{versioning:""},{})}async function Ua(t){return this.fetchBucket(t.bucket,"PUT",{versioning:""},{},{Status:t.status})}function za(t){const e=Fa.call(this,t);Ga(t.conditions);const a=`http${this.opts.secure?"s":""}://${t.alternativeEndpoint||(t.isCustomDomain?this.opts.endpoint:`${e.bucket}.${this.opts.endpoint}`)}`,n=$(this.getSignatureQuery({bucket:e.bucket,expires:e.expires,policy:{conditions:e.conditions}}));return{getSignedURLForList:t=>{const e=$(t),o=[n,e].filter(Boolean).join("&");return`${a}?${o}`},getSignedURLForGetOrHead:(t,e)=>{const o=$(e),i=[n,o].filter(Boolean).join("&"),c=t.split("/").map(t=>encodeURIComponent(t)).join("/");return`${a}/${c}?${i}`},signedQuery:n}}function Fa(t){const e=t.bucket||this.opts.bucket;if(!e)throw new w("Must provide bucket param");Ga(t.conditions);const a=t.conditions.map(t=>[t.operator||"eq","$key",t.value]);return a.push(["eq","$bucket",e]),{bucket:e,expires:t.expires||3600,conditions:a}}function Ga(t){if(t.length<1)throw new w("The `conditions` field of `PreSignedPolicyURLInput` must has one item at least");for(const e of t){if("key"!==e.key)throw new w("The `key` field of `PolicySignatureCondition` must be `'key'`");if(e.operator&&"eq"!==e.operator&&"starts-with"!==e.operator)throw new w("The `operator` field of `PolicySignatureCondition` must be `'eq'` or `'starts-with'`")}}async function Ka(t){const{bucket:e}=t;return this.fetchBucket(e,"GET",{location:""},{})}async function qa(t){try{const{bucket:e}=t;return await this.fetchBucket(e,"GET",{cors:""},{})}catch(t){return Ma(t,{defaultResponse:{CORSRules:[]},enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketCORS"})}}async function $a(t){const{bucket:e,CORSRules:a}=t;return this.opts.enableOptimizeMethodBehavior&&!a.length?Va.call(this,{bucket:e}):this.fetchBucket(e,"PUT",{cors:""},{},{CORSRules:a})}async function Va(t){const{bucket:e}=t;return this.fetchBucket(e,"DELETE",{cors:""},{})}async function Ha(t){const{bucket:e,rules:a}=t;if(this.opts.enableOptimizeMethodBehavior&&!a.length)return Ja.call(this,{bucket:e});const n={};return Q({...t,headers:n},["allowSameActionOverlap"]),this.fetchBucket(e,"PUT",{lifecycle:""},n,{Rules:a})}async function Wa(t){try{const{bucket:e}=t;return await this.fetchBucket(e,"GET",{lifecycle:""},{},{},{handleResponse:t=>({AllowSameActionOverlap:t.headers["x-tos-allow-same-action-overlap"],Rules:t.data.Rules})})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketLifecycle",defaultResponse:{Rules:[]}})}}async function Ja(t){const{bucket:e}=t;return this.fetchBucket(e,"DELETE",{lifecycle:""},{})}async function Qa(t){const{bucket:e,rule:a}=t;return this.fetchBucket(e,"PUT",{encryption:""},{"Content-MD5":_t(JSON.stringify({Rule:a}),"base64")},{Rule:a})}async function Xa(t){const{bucket:e}=t;return this.fetchBucket(e,"GET",{encryption:""},{})}async function Ya(t){const{bucket:e}=t;return this.fetchBucket(e,"DELETE",{encryption:""},{})}async function Za(t){const{bucket:e,rules:a}=t;return this.opts.enableOptimizeMethodBehavior&&!a.length?en.call(this,{bucket:e}):this.fetchBucket(e,"PUT",{mirror:""},{},{Rules:a})}async function tn(t){const{bucket:e}=t;try{return await this.fetchBucket(e,"GET",{mirror:""},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketMirrorBack",defaultResponse:{Rules:[]}})}}async function en(t){const{bucket:e}=t;return this.fetchBucket(e,"DELETE",{mirror:""},{})}async function an(t){const{tagSet:e,versionId:a}=t,n=U({versionId:a});return this._fetchObject(t,"PUT",{tagging:"",...n},{},{TagSet:e})}async function nn(t){const{versionId:e}=t,a=U({versionId:e}),n=await this._fetchObject(t,"GET",{tagging:"",...a},{});return M(n.data.TagSet)("Tags"),n}async function on(t){const{versionId:e}=t,a=U({versionId:e});return this._fetchObject(t,"DELETE",{tagging:"",...a},{})}async function cn(t){const{bucket:e,rules:a,role:n}=t;return this.opts.enableOptimizeMethodBehavior&&!a.length?rn.call(this,{bucket:e}):this.fetchBucket(e,"PUT",{replication:""},{},{Role:n,Rules:a})}async function sn(t){const{bucket:e,progress:a,ruleId:n}=t,o={replication:"",progress:a||""};null!=n&&(o["rule-id"]=""+n);try{return await this.fetchBucket(e,"GET",o,{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketReplication",defaultResponse:{Rules:[],Role:""}})}}async function rn(t){const{bucket:e}=t;return this.fetchBucket(e,"DELETE",{replication:""},{})}async function un(t){const{bucket:e,...a}=t,n=N(a);return this.fetchBucket(e,"PUT",{website:""},{},{...n})}async function ln(t){const{bucket:e}=t;try{return this.fetchBucket(e,"GET",{website:""},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketWebsite",defaultResponse:{RoutingRules:[]}})}}async function pn(t){const{bucket:e}=t;return this.fetchBucket(e,"DELETE",{website:""},{})}async function dn(t){const{bucket:e,...a}=t,n=N(a);return this.fetchBucket(e,"PUT",{notification:""},{},{...n})}async function hn(t){const{bucket:e}=t;try{return await this.fetchBucket(e,"GET",{notification:""},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketNotification",defaultResponse:{CloudFunctionConfigurations:[],RocketMQConfigurations:[]}})}}async function fn(t){const{bucket:e,...a}=t,n=N(a);return this.fetchBucket(e,"PUT",{customdomain:""},{},{...n})}async function mn(t){try{const{bucket:e}=t;return await this.fetchBucket(e,"GET",{customdomain:""},{})}catch(t){return Ma(t,{defaultResponse:{CustomDomainRules:[]},enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketCustomDomain"})}}async function yn(t){const{bucket:e,customDomain:a}=t;return this.fetchBucket(e,"DELETE",{customdomain:a},{})}async function gn(t){const{bucket:e,...a}=t,n=N(a);return this.fetchBucket(e,"PUT",{realtimeLog:""},{},{...n})}async function xn(t){const{bucket:e}=t;try{return await this.fetchBucket(e,"GET",{realtimeLog:""},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketRealTimeLog",defaultResponse:{}})}}async function kn(t){const{bucket:e}=t;return this.fetchBucket(e,"DELETE",{realtimeLog:""},{})}var bn,Tn,vn,wn,Sn,En,Cn;async function Bn(t){try{return await this.fetchBucket(t.bucket,"GET",{inventory:"",id:t.id},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketInventory",defaultResponse:void 0})}}async function Pn(t){const e={inventory:"",...t.continuationToken?{"continuation-token":t.continuationToken}:null};try{return await this.fetchBucket(t.bucket,"GET",e,{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"listBucketInventory",defaultResponse:{InventoryConfigurations:[]}})}}async function In(t){return this.fetchBucket(t.bucket,"DELETE",{inventory:"",id:t.id},{})}function Rn(t){return this.fetchBucket(t.bucket,"PUT",{inventory:"",id:t.inventoryConfiguration.Id},{},t.inventoryConfiguration)}async function An(t){const{accountId:e,...a}=t,n=N(a);return await this.fetch("POST","/jobs",{},{"x-tos-account-id":e},{...n})}async function Dn(t){const{accountId:e,maxResults:a=1e3,...n}=t;return await this.fetch("GET","/jobs",{maxResults:a,...n},{"x-tos-account-id":e},{},{axiosOpts:{paramsSerializer:X}})}async function On(t){const{accountId:e,jobId:a,priority:n}=t;return await this.fetch("POST",`/jobs/${a}/priority`,{priority:n},{"x-tos-account-id":e},{},{needMd5:!0})}async function Mn(t){const{accountId:e,jobId:a,requestedJobStatus:n,statusUpdateReason:o}=t;return await this.fetch("POST",`/jobs/${a}/status`,{requestedJobStatus:n,statusUpdateReason:o},{"x-tos-account-id":e},{},{needMd5:!0})}async function _n(t){const{accountId:e,JobId:a}=t;return await this.fetch("DELETE","/jobs/"+a,{},{"x-tos-account-id":e},{})}async function jn(t){const{accountId:e,JobId:a}=t;return await this.fetch("GET","/jobs/"+a,{},{"x-tos-account-id":e},{})}async function Nn(t){return await this.fetchBucket(t.bucket,"PUT",{tagging:""},{},t.tagging,{needMd5:!0})}async function Ln({bucket:t}){try{return await this.fetchBucket(t,"GET",{tagging:""},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketTagging",defaultResponse:{TagSet:{Tags:[]}}})}}async function Un({bucket:t}){return this.fetchBucket(t,"DELETE",{tagging:""},{})}async function zn(t){return await this.fetchBucket(t.bucket,"PUT",{payByTraffic:""},{},t.payByTraffic)}async function Fn({bucket:t}){return await this.fetchBucket(t,"GET",{payByTraffic:""},{})}async function Gn(t){const{bucket:e}=t;try{return await this.fetchBucket(e,"GET",{imageStyleBriefInfo:""},{})}catch(t){if(t instanceof v&&404===t.statusCode)return this.getNormalDataFromError({BucketName:e,ImageStyleBriefInfo:[]},t);throw t}}async function Kn(t){try{return await this.fetchBucket(t,"GET",{imageStyle:""},{})}catch(t){if(t instanceof v&&404===t.statusCode)return this.getNormalDataFromError({ImageStyles:[]},t);throw t}}async function qn(t){try{const{bucket:e,styleName:a}=t;return await this.fetchBucket(e,"GET",{imageStyleContent:"",styleName:a},{})}catch(t){if(t instanceof v&&404===t.statusCode)return this.getNormalDataFromError({ImageStyles:[]},t);throw t}}async function $n(t,e){try{return await this.fetchBucket(t,"GET",{imageStyle:"",styleName:e},{})}catch(t){if(t instanceof v&&404===t.statusCode)return this.getNormalDataFromError(null,t);throw t}}async function Vn(t){const{bucket:e,styleName:a,content:n,styleObjectPrefix:o}=t;try{return await this.fetchBucket(e,"PUT",{imageStyle:"",styleName:a,styleObjectPrefix:o},{},{Content:n})}catch(t){if(t instanceof v&&404===t.statusCode)return this.getNormalDataFromError(null,t);throw t}}async function Hn(t){const{styleName:e,styleObjectPrefix:a,bucket:n}=t;try{return await this.fetchBucket(n,"DELETE",{imageStyle:"",styleName:e,styleObjectPrefix:a},{})}catch(t){if(t instanceof v&&404===t.statusCode)return this.getNormalDataFromError(null,t);throw t}}async function Wn(t,e){try{return await this.fetchBucket(t,"PUT",{originalImageProtect:""},{},e)}catch(t){if(t instanceof v&&404===t.statusCode)return this.getNormalDataFromError(null,t);throw t}}async function Jn(t){try{return await this.fetchBucket(t,"GET",{originalImageProtect:""},{})}catch(t){if(t instanceof v&&404===t.statusCode)return this.getNormalDataFromError(null,t);throw t}}async function Qn(t){const{bucket:e,Separator:a,SeparatorSuffix:n}=t;try{return await this.fetchBucket(e,"PUT",{imageStyleSeparator:""},{},{Separator:a,SeparatorSuffix:n})}catch(t){if(t instanceof v&&404===t.statusCode)return this.getNormalDataFromError(null,t);throw t}}async function Xn(t){try{return await this.fetchBucket(t,"GET",{imageStyleSeparator:""},{})}catch(t){if(t instanceof v&&404===t.statusCode)return this.getNormalDataFromError(null,t);throw t}}async function Yn(t){try{return await this.fetchBucket(t,"GET",{intelligenttiering:""},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketIntelligenttiering",defaultResponse:{}})}}async function Zn(t){const{bucket:e,...a}=t,n=N(a);return this.fetchBucket(e,"PUT",{rename:""},{},{...n})}async function to(t){const{bucket:e}=t;return await this.fetchBucket(e,"GET",{rename:""},{})}async function eo(t){const{bucket:e}=t;return this.fetchBucket(e,"DELETE",{rename:""},{})}async function ao(t){const{versionId:e,...a}=t,n={restore:""};e&&(n.versionId=e);const o=N(a);return this._fetchObject(t,"POST",n,{},o)}async function no(t){const{accountId:e}=t;return await this.fetch("GET","/storagelens",{},{"x-tos-account-id":e},{},{axiosOpts:{paramsSerializer:X}})}async function oo(t){const{accountId:e,Id:a}=t;return await this.fetch("DELETE","/storagelens",{id:a},{"x-tos-account-id":e},{},{needMd5:!0})}async function io(t){const{accountId:e,Id:a}=t;return await this.fetch("GET","/storagelens",{id:a},{"x-tos-account-id":e},{},{needMd5:!0})}async function co(t){const{accountId:e,Id:a,...n}=t;return await this.fetch("PUT","/storagelens",{id:a},{"x-tos-account-id":e},{...n,Id:a},{needMd5:!0})}async function so(t){const{bucket:e,...a}=t,n=N(a);return this.fetchBucket(e,"PUT",{notification_v2:""},{},{...n})}async function ro(t){const{bucket:e}=t;try{return await this.fetchBucket(e,"GET",{notification_v2:""},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketNotificationType2",defaultResponse:{Rules:[]}})}}async function uo(t){return lo.call(this,t)}async function lo(t){const e=t.headers=U(t.headers);return Q(t,["symLinkTargetKey","symLinkTargetBucket","forbidOverwrite","acl","storageClass","meta"]),this._fetchObject(t,"PUT",{symlink:""},e,void 0,{handleResponse(t){const{headers:e}=t;return{VersionID:e["x-tos-version-id"]}}})}async function po(t){return ho.call(this,t)}async function ho(t){const e={symlink:""};return t.versionId&&(e.versionId=t.versionId),this._fetchObject(t,"GET",e,{},void 0,{handleResponse:t=>{const{headers:e}=t;return{VersionID:e["x-tos-version-id"],SymlinkTargetKey:e["x-tos-symlink-target"],SymlinkTargetBucket:e["x-tos-symlink-bucket"],LastModified:e["last-modified"]}}})}async function fo(t){const{bucket:e,...a}=t,n=N(a);return this.fetchBucket(e,"PUT",{transferAcceleration:""},{},{...n})}async function mo(t){try{const{bucket:e}=t,a={};return t.getStatus&&(a["x-tos-get-bucket-acceleration-status"]="true"),await this.fetchBucket(e,"GET",{transferAcceleration:""},a)}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketTransferAcceleration",defaultResponse:{TransferAccelerationConfiguration:{Enabled:"false",Status:exports.TransferAccelerationStatusType.Terminated}}})}}async function yo(t){const{bucket:e,status:a}=t;return this.fetchBucket(e,"PUT",{accessmonitor:""},{},{Status:a})}async function go(t){try{const{bucket:e}=t;return await this.fetchBucket(e,"GET",{accessmonitor:""},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketAccessMonitor",defaultResponse:{}})}}async function xo(t){const{accountId:e}=t;return await this.fetch("GET","/qospolicy",{},{"x-tos-account-id":e},{},{})}async function ko(t){const{accountId:e,...a}=t;return await this.fetch("PUT","/qospolicy",{},{"x-tos-account-id":e},{...a},{})}async function bo(t){const{accountId:e}=t;return await this.fetch("DELETE","/qospolicy",{},{"x-tos-account-id":e},{},{})}async function To(t){const{accountId:e,name:a,regions:n}=t;return await this.fetch("POST","/mrap",{name:a},{"x-tos-account-id":e},{Name:a,Regions:n},{})}async function vo(t){const{name:e,accountId:a}=t;return await this.fetch("GET","/mrap",{name:e},{"x-tos-account-id":a},{},{})}async function wo(t){const{accountId:e,...a}=t;return await this.fetch("GET","/mrap",{...a},{"x-tos-account-id":e},{},{})}async function So(t){const{accountId:e,alias:a}=t;return await this.fetch("GET","/mrap/routes",{alias:a},{"x-tos-account-id":e})}async function Eo(t){const{name:e,accountId:a}=t;return await this.fetch("DELETE","/mrap",{name:e},{"x-tos-account-id":a})}async function Co(t){const{routes:e,accountId:a,alias:n}=t;return await this.fetch("PATCH","/mrap/routes",{alias:n},{"x-tos-account-id":a},{Routes:e})}async function Bo(t){const{AccountId:e,MultiRegionAccessPointAlias:a,AcceleratorId:n}=t;return await this.fetch("PUT",`/accelerator/${n}/mrap/${a}`,{},{"x-tos-account-id":e},{},{})}async function Po(t){const{AccountId:e,MultiRegionAccessPointAlias:a,AcceleratorId:n}=t;return await this.fetch("DELETE",`/accelerator/${n}/mrap/${a}`,{},{"x-tos-account-id":e},{},{})}async function Io(t){const{AccountId:e,AcceleratorId:a}=t;return await this.fetch("GET",`/accelerator/${a}/mrap`,{},{"x-tos-account-id":e},{},{})}async function Ro(t){const{BucketAccountId:e,Name:a,AccountId:n,Bucket:o,NetworkOrigin:i,VpcId:c}=t;return await this.fetch("PUT","/accesspoint/"+a,{name:""},{"x-tos-account-id":n},{BucketAccountId:e,Bucket:o,NetworkOrigin:i,VpcId:c},{})}async function Ao(t){const{Name:e,AccountId:a}=t;return await this.fetch("GET","/accesspoint/"+e,{},{"x-tos-account-id":a},{},{})}async function Do(t){const{AccountId:e,...a}=t;return await this.fetch("GET","/accesspoint",{...a},{"x-tos-account-id":e},{},{})}async function Oo(t){const{Name:e,AccountId:a}=t;return await this.fetch("DELETE","/accesspoint/"+e,{},{"x-tos-account-id":a})}async function Mo(t){const{AccountId:e,AcceleratorAccountId:a,AccessPointName:n,AcceleratorId:o}=t;return await this.fetch("PUT",`/accesspoint/${n}/accelerator/${o}`,{},{"x-tos-account-id":e},{AcceleratorAccountId:a},{})}async function _o(t){const{AccountId:e,AccessPointName:a,AcceleratorId:n}=t;return await this.fetch("DELETE",`/accesspoint/${a}/accelerator/${n}`,{},{"x-tos-account-id":e},{},{})}async function jo(t){const{AccountId:e,AcceleratorId:a,...n}=t;return await this.fetch("GET",`/accelerator/${a}/accesspoint`,{...n},{"x-tos-account-id":e},{},{})}async function No(t){const{AccountId:e,...a}=t;return await this.fetch("POST","/accelerator",{name:""},{"x-tos-account-id":e},{...a},{})}async function Lo(t){const{Id:e,AccountId:a}=t;return await this.fetch("GET","/accelerator",{id:e},{"x-tos-account-id":a},{},{})}async function Uo(t){const{AccountId:e,...a}=t;return await this.fetch("GET","/accelerator",{...a},{"x-tos-account-id":e},{},{})}async function zo(t){const{Id:e,AccountId:a}=t;return await this.fetch("DELETE","/accelerator",{id:e},{"x-tos-account-id":a})}async function Fo(t){const{AccountId:e,...a}=t;return await this.fetch("GET","/accelerator/az",{...a},{"x-tos-account-id":e},{},{})}async function Go(t){const{AccountId:e,...a}=t;return await this.fetch("POST","/accelerator/prefetchJob",{acceleratorId:a.AcceleratorId},{"x-tos-account-id":e},{...a},{})}async function Ko(t){const{AccountId:e,JobId:a}=t;return await this.fetch("GET","/accelerator/prefetchJob",{jobId:a},{"x-tos-account-id":e},{},{})}async function qo(t){const{JobId:e,AccountId:a}=t;return await this.fetch("DELETE","/accelerator/prefetchJob",{jobId:e},{"x-tos-account-id":a})}async function $o(t){const{AccountId:e,AcceleratorId:a,...n}=t;return await this.fetch("GET","/accelerator/prefetchJob",{acceleratorId:a,...n},{"x-tos-account-id":e},{},{})}async function Vo(t){const{AccountId:e,JobId:a,...n}=t;return await this.fetch("GET","/accelerator/prefetchRecord",{jobId:a,...n},{"x-tos-account-id":e},{},{})}async function Ho(t){const{AccountId:e,Az:a}=t;return await this.fetch("GET","/accelerator/capacity",{az:a},{"x-tos-account-id":e},{},{})}async function Wo(t){const{AccountId:e,AccessPointName:a}=t;return await this.fetch("GET",`/accesspoint/${a}/accelerator`,{},{"x-tos-account-id":e},{},{})}!function(t){t.Daily="Daily",t.Weekly="Weekly",t.Once="Once"}(bn||(bn={})),function(t){t.All="All",t.Current="Current"}(Tn||(Tn={})),function(t){t.Size="Size",t.LastModifiedDat="LastModifiedDate",t.ETag="ETag",t.StorageClass="StorageClass",t.IsMultipartUploaded="IsMultipartUploaded",t.EncryptionStatus="EncryptionStatus",t.CRC64="CRC64",t.ReplicationStatus="ReplicationStatus",t.RetentionMode="RetentionMode",t.RetainUntilTimestamp="RetainUntilTimestamp",t.IntelligentTieringAccessTier="IntelligentTieringAccessTier"}(vn||(vn={})),function(t){t.StringEquals="StringEquals",t.StringNotEquals="StringNotEquals",t.StringEqualsIgnoreCase="StringEqualsIgnoreCase",t.StringNotEqualsIgnoreCase="StringNotEqualsIgnoreCase",t.StringLike="StringLike",t.StringNotLike="StringNotLike"}(wn||(wn={})),function(t){t.DateEquals="DateEquals",t.DateNotEquals="DateNotEquals",t.DateLessThan="DateLessThan",t.DateLessThanEquals="DateLessThanEquals",t.DateGreaterThan="DateGreaterThan",t.DateGreaterThanEquals="DateGreaterThanEquals"}(Sn||(Sn={})),function(t){t.IpAddress="IpAddress",t.NotIpAddress="NotIpAddress"}(En||(En={})),function(t){t.WritesQps="WritesQps",t.ReadsQps="ReadsQps",t.ListQps="ListQps",t.WritesRate="WritesRate",t.ReadsRate="ReadsRate"}(Cn||(Cn={}));const Jo=async function(t){const{accountId:e,alias:a,rules:n}=t;return this.opts.enableOptimizeMethodBehavior&&!n.length?Xo.call(this,{accountId:e,alias:a}):await this.fetch("PUT","/mrap/mirror",{alias:a},{"x-tos-account-id":e},{Rules:n},{handleResponse:()=>({})})},Qo=async function(t){const{accountId:e,alias:a}=t;try{const t=await this.fetch("GET","/mrap/mirror",{alias:a},{"x-tos-account-id":e},{},{});return M(t.data)("Rules"),t}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getMultiRegionAccessPointMirrorBack",defaultResponse:{Rules:[]}})}},Xo=async function(t){const{accountId:e,alias:a}=t;return await this.fetch("DELETE","/mrap/mirror",{alias:a},{"x-tos-account-id":e},{},{handleResponse:()=>({})})};async function Yo(t){const{bucket:e,enable:a}=t;return await this.fetchBucket(e,"PUT",{privateM3U8:""},{},{Enable:a})}async function Zo(t){const{bucket:e}=t;try{return await this.fetchBucket(e,"GET",{privateM3U8:""},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketPrivateM3U8",defaultResponse:{Enable:!1}})}}async function ti(t){const{bucket:e,enable:a}=t;return await this.fetchBucket(e,"PUT",{blindWatermark:""},{},{Enable:a})}async function ei(t){const{bucket:e}=t;try{return await this.fetchBucket(e,"GET",{blindWatermark:""},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketBlindWatermark",defaultResponse:{Enable:!1}})}}async function ai(t){const{bucket:e,...a}=t,n=N(a);return this.fetchBucket(e,"PUT",{trash:""},{},{...n})}async function ni(t){const{bucket:e}=t;return await this.fetchBucket(e,"GET",{trash:""},{})}async function oi(t){const{bucket:e,objectLockEnabled:a,rule:n}=t;return this.fetchBucket(e,"PUT",{"object-lock":""},{},{ObjectLockEnabled:a,Rule:n})}async function ii(t){const{bucket:e}=t;try{return await this.fetchBucket(e,"GET",{"object-lock":""},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketObjectLockConfiguration",defaultResponse:{}})}}async function ci(t){const{versionId:e,mode:a,retainUntilDate:n}=t,o={retention:""};return e&&(o.versionId=e),this._fetchObject(t,"PUT",o,{},{Mode:a,RetainUntilDate:n})}async function si(t){const{versionId:e}=t,a={retention:""};e&&(a.versionId=e);try{return await this._fetchObject(t,"GET",a,{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getObjectRetention",defaultResponse:{}})}}async function ri(t){const{bucket:e,role:a,rules:n}=t;return this.opts.enableOptimizeMethodBehavior&&!n.length?li.call(this,{bucket:e}):this.fetchBucket(e,"PUT",{cdn_notification:""},{},{Role:a,Rules:n})}async function ui(t){const{bucket:e}=t;try{return await this.fetchBucket(e,"GET",{cdn_notification:""},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketCdnNotification",defaultResponse:{Rules:[],Role:""}})}}async function li(t){const{bucket:e}=t;return await this.fetchBucket(e,"DELETE",{cdn_notification:""},{})}async function pi(t){const{bucket:e,role:a,rules:n}=t;return this.opts.enableOptimizeMethodBehavior&&!n.length?hi.call(this,{bucket:e}):this.fetchBucket(e,"PUT",{workflow:""},{},{Role:a,Rules:n})}async function di(t){const{bucket:e}=t;try{return await this.fetchBucket(e,"GET",{workflow:""},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketWorkflow",defaultResponse:{Rules:[]}})}}async function hi(t){const{bucket:e}=t,a=await this.fetchBucket(e,"DELETE",{workflow:""},{});return a.data||(a.data={}),a}async function fi(t){const{bucket:e,executionId:a}=t;try{return await this.fetchBucket(e,"GET",{workflow_execution:"",id:a},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketWorkflowExecution",defaultResponse:null})}}async function mi(t){const{bucket:e,workflowId:a,startTime:n,endTime:o,states:i,orderByTime:c,pageSize:s,pageToken:r}=t;try{const t={workflow_execution:""};return a&&(t.workflow_id=a),void 0!==n&&(t.start_time=n.toString()),void 0!==o&&(t.end_time=o.toString()),i&&(t.states=i),c&&(t.order_by_time=c),void 0!==s&&(t.page_size=s.toString()),r&&(t.page_token=r),await this.fetchBucket(e,"GET",t,{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"listBucketWorkflowExecution",defaultResponse:{Items:[]}})}}async function yi(t){const{bucket:e,Input:a,FileCompressConfig:n,Output:o}=t;return await this.fetchBucket(e,"POST",{file_jobs:"",job_type:"FileCompress"},{},{Input:a,FileCompressConfig:n,Output:o})}async function gi(t){const{bucket:e,Input:a,FileUncompressConfig:n,Output:o}=t;return await this.fetchBucket(e,"POST",{file_jobs:"",job_type:"FileUncompress"},{},{Input:a,FileUncompressConfig:n,Output:o})}async function xi(t){try{return await this.fetchBucket(t.bucket,"GET",{logging:""},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketLogging",defaultResponse:void 0})}}function ki(t){return this.fetchBucket(t.bucket,"PUT",{logging:""},{},{LoggingEnabled:{TargetBucket:t.data.targetBucket,TargetPrefix:t.data.targetPrefix,Role:t.data.role}})}function bi(t){return this.fetchBucket(t.bucket,"PUT",{logging:""},{},{})}async function Ti(t){var e;const{accountId:a,name:n,policy:o}=t;return!this.opts.enableOptimizeMethodBehavior||null!=(e=o.Statement)&&e.length?this.fetch("PUT",`/accesspoint/${n}/policy`,{},{"x-tos-account-id":a},o):wi.call(this,{accountId:a,name:n})}async function vi(t){const{accountId:e,name:a}=t;try{return await this.fetch("GET",`/accesspoint/${a}/policy`,{},{"x-tos-account-id":e},void 0,{handleResponse:t=>({Policy:t.data})})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getAccessPointPolicy",defaultResponse:{Policy:{Version:"2012-10-17",Statement:[]}}})}}async function wi(t){const{accountId:e,name:a}=t;return this.fetch("DELETE",`/accesspoint/${a}/policy`,{},{"x-tos-account-id":e})}async function Si(t){var e;const{accountId:a,name:n,policy:o}=t;return!this.opts.enableOptimizeMethodBehavior||null!=(e=o.Statement)&&e.length?await this.fetch("PUT",`/mrap/${n}/policy`,{},{"x-tos-account-id":a},o,{}):Ci.call(this,{accountId:a,name:n})}async function Ei(t){const{accountId:e,name:a}=t;try{return await this.fetch("GET",`/mrap/${a}/policy`,{},{"x-tos-account-id":e},void 0,{handleResponse:t=>({Policy:t.data})})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getMultiRegionAccessPointMirrorBack",defaultResponse:{Policy:{Version:"2012-10-17",Statement:[]}}})}}async function Ci(t){const{accountId:e,name:a}=t;return await this.fetch("DELETE",`/mrap/${a}/policy`,{},{"x-tos-account-id":e},{},{handleResponse:()=>({})})}async function Bi(t){const{bucket:e}=t;try{return await this.fetchBucket(e,"GET",{audit:""},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketAudit",defaultResponse:null})}}async function Pi(t){const{bucket:e,action:a}=t;return await this.fetchBucket(e,"PUT",{action:a,audit:""},{})}async function Ii(t){const{bucket:e,startTime:a,endTime:n,pageSize:o,pageToken:i}=t,c={job_type:"AuditStock"};return void 0!==a&&(c.start_time=a.toString()),void 0!==n&&(c.end_time=n.toString()),void 0!==o&&(c.page_size=o.toString()),void 0!==i&&(c.page_token=i),await this.fetchBucket(e,"GET",c,{})}async function Ri(t){const{bucket:e,jobId:a}=t;try{return await this.fetchBucket(e,"GET",{job_type:"AuditStock",job_id:a},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketAuditJob",defaultResponse:null})}}async function Ai(t){const{bucket:e,job:a}=t;return await this.fetchBucket(e,"POST",{job_type:"AuditStock",audit_jobs:""},{},a)}async function Di(t){const{bucket:e,audit_type:a}=t;return this.fetchBucket(e,"GET",{type:a,audits:""},{})}async function Oi(t){const{bucket:e,job:a}=t;return await this.fetchBucket(e,"POST",{increment_audit:""},{},{AuditConfiguration:a})}async function Mi(t){const{bucket:e,pageSize:a,pageToken:n,audiType:o}=t,i={increment_audits:"",audit_type:o};return void 0!==a&&(i.page_size=a.toString()),void 0!==n&&(i.page_token=n),await this.fetchBucket(e,"GET",i,{})}async function _i(t){const{bucket:e,ruleId:a}=t;try{return await this.fetchBucket(e,"GET",{increment_audit:"",rule_id:a},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketIncrementAudits",defaultResponse:null})}}async function ji(t){const{bucket:e,ruleId:a}=t;return this.fetchBucket(e,"DELETE",{increment_audit:"",rule_id:a},{})}async function Ni(t){const{bucket:e,jobType:a,startTime:n,endTime:o,pageSize:i,pageToken:c}=t,s={job_type:a};return void 0!==n&&(s.start_time=n.toString()),void 0!==o&&(s.end_time=o.toString()),void 0!==i&&(s.page_size=i.toString()),void 0!==c&&(s.page_token=c),await this.fetchBucket(e,"GET",s,{})}async function Li(t){const{bucket:e,jobType:a,jobId:n}=t;try{return await this.fetchBucket(e,"GET",{job_type:a,job_id:n},{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketJob",defaultResponse:null})}}async function Ui(t){const{bucket:e,Input:a,Output:n,AudioConvertConfig:o}=t,i=await this.fetchBucket(e,"POST",{job_type:"AudioConvert",media_jobs:""},{},{Input:a,AudioConvertConfig:o,Output:n});return i.data||(i.data={}),i}async function zi(t){const{versionId:e}=t,a=U({versionId:e});return await this._fetchObject(t,"GET",{"x-tos-process":"image/aitag",...a},{})}async function Fi(t){const{bucket:e,...a}=t,n=N(a);return this.fetchBucket(e,"PUT",{requestPayment:""},{},{...n})}async function Gi(t){const{bucket:e}=t;return await this.fetchBucket(e,"GET",{requestPayment:""},{})}const Ki=t=>Object.fromEntries(Object.entries(t).filter(([t,e])=>void 0!==e));var qi,$i,Vi,Hi,Wi;async function Ji(t){const{accountId:e,...a}=t;return await this.fetch("POST","/dataset",{},{"x-tos-account-id":e},Ki(a),{})}async function Qi(t){const{datasetname:e,accountId:a}=t;return await this.fetch("GET","/dataset",{datasetname:e},{"x-tos-account-id":a})}async function Xi(t){const{accountId:e,datasetname:a}=t;return await this.fetch("DELETE","/dataset",{datasetname:a},{"x-tos-account-id":e})}async function Yi(t){const{accountId:e,...a}=t;return await this.fetch("GET","/datasets",Ki(a),{"x-tos-account-id":e})}async function Zi(t){const{accountId:e,...a}=t;return await this.fetch("POST","/datasetbinding",{},{"x-tos-account-id":e},Ki(a))}async function tc(t){const{accountId:e,...a}=t;return await this.fetch("DELETE","/datasetbinding",{},{"x-tos-account-id":e},Ki(a),{})}async function ec(t){const{accountId:e,...a}=t;return await this.fetch("GET","/datasetbinding",Ki(a),{"x-tos-account-id":e})}async function ac(t){const{accountId:e,...a}=t;return await this.fetch("GET","/datasetbindings",Ki(a),{"x-tos-account-id":e})}async function nc(t){const{accountId:e,...a}=t;return await this.fetch("POST","/datasetquery",{mode:"SimpleQuery"},{"x-tos-account-id":e},Ki(a))}async function oc(t){const{accountId:e,...a}=t;return await this.fetch("POST","/datasetquery",{mode:"SemanticQuery"},{"x-tos-account-id":e},Ki(a))}async function ic(t){const{bucket:e,tag:a,name:n,audioConvertConfig:o}=t,i=await this.fetchBucket(e,"PUT",{process_template:"",tag:a},{},{Tag:a,Name:n,AudioConvertConfig:o});return i.data={},i}async function cc(t){const{bucket:e,tag:a,prefix:n}=t,o={process_template:"",tag:a};return n&&(o.prefix=n),await this.fetchBucket(e,"GET",o,{})}async function sc(t){const{bucket:e,id:a,tag:n}=t,o={process_template:"",tag:n,id:a};try{return await this.fetchBucket(e,"GET",o,{})}catch(t){return Ma(t,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,defaultResponse:null,methodKey:"getBucketDataProcessTemplate"})}}async function rc(t){const{bucket:e,id:a}=t,n=await this.fetchBucket(e,"DELETE",{process_template:"",id:a},{},"");return n.data={},n}async function uc(t){const{bucket:e,name:a,audioConvertConfig:n}=t,o={Tag:"AudioConvert",Name:a,AudioConvertConfig:n},i=await this.fetchBucket(e,"PUT",{process_template:"",tag:"AudioConvert"},{"Content-Type":"application/json"},o);return i.data={ID:i.data},i}async function lc(t){const{bucket:e,id:a}=t,n={process_template:"",tag:"AudioConvert",id:a};return await this.fetchBucket(e,"GET",n,{})}async function pc(t){const{bucket:e,id:a}=t,n={process_template:"",tag:"AudioConvert"};a&&(n.id=a);const o=await this.fetchBucket(e,"GET",n,{});return o.data={AudioConvertTemplates:o.data||[]},o}async function dc(t){const{bucket:e,id:a}=t,n={process_template:"",id:a},o=await this.fetchBucket(e,"DELETE",n,{},"");return o.data={},o}async function hc(t){const{bucket:e,name:a,transcodeConfig:n}=t,o={Tag:"Transcode",Name:a,TranscodeConfig:n},i=await this.fetchBucket(e,"PUT",{process_template:"",tag:"Transcode"},{},o);return{...i,data:{ID:i.data}}}async function fc(t){const{bucket:e,id:a}=t,n={process_template:"",tag:"Transcode",id:a};return await this.fetchBucket(e,"GET",n,{})}async function mc(t){const{bucket:e,id:a}=t,n={process_template:"",id:a},o=await this.fetchBucket(e,"DELETE",n,{},"");return o.data={},o}async function yc(t){const{bucket:e}=t,a=await this.fetchBucket(e,"GET",{process_template:"",tag:"Transcode"},{});return a.data={VideoConvertTemplates:a.data||[]},a}async function gc(t){const{bucket:e,input:a,transcodeConfig:n,output:o}=t,i={Tag:"Transcode",Input:a,TranscodeConfig:n,Output:o};return await this.fetchBucket(e,"POST",{job_type:"Transcode",media_jobs:""},{},i)}async function xc(t){const{bucket:e,jobId:a}=t,n={job_type:"Transcode",job_id:a,media_jobs:""};return await this.fetchBucket(e,"GET",n,{})}async function kc(t){const{bucket:e,input:a,audioConvertConfig:n,output:o}=t,i={Tag:"AudioConvert",Input:a,AudioConvertConfig:n,Output:o};return await this.fetchBucket(e,"POST",{job_type:"AudioConvert",media_jobs:""},{},i)}async function bc(t){const{bucket:e,jobId:a}=t,n={job_type:"AudioConvert",job_id:a};return await this.fetchBucket(e,"GET",n,{})}async function Tc(t){const{accountId:e}=t;return await this.fetch("GET","/templates",{},{"x-tos-account-id":e},{})}async function vc(t){const{bucket:e,targetRedundancyType:a}=t;return this.fetchBucket(e,"POST",{redundancyTransition:"","x-tos-target-redundancy-type":a},{},{})}async function wc(t){const{bucket:e,redundancyTransitionTaskId:a}=t;return await this.fetchBucket(e,"GET",{redundancyTransition:"","x-tos-redundancy-transition-taskid":a},{})}async function Sc(t){const{bucket:e,redundancyTransitionTaskId:a}=t;return this.fetchBucket(e,"DELETE",{redundancyTransition:"","x-tos-redundancy-transition-taskid":a},{})}async function Ec(t){const{bucket:e,maxKeys:a,continuationToken:n}=t;return this.fetchBucket(e,"GET",{redundancyTransition:"","max-keys":a,"continuation-token":n},{})}async function Cc(t){const{bucket:e}=t;return this.fetchBucket(e,"GET",{estimatedRemainingTime:""},{})}async function Bc(t){const{continuationToken:e,maxKeys:a}=t;return this.fetch("GET","/",{redundancyTransition:"","max-keys":a,"continuation-token":e},{})}async function Pc(t){const{bucket:e,rules:a}=t;return this.fetchBucket(e,"PUT",{workflow:""},{},{Rules:a})}async function Ic(t){const{bucket:e}=t;return this.fetchBucket(e,"GET",{workflow:""},{})}async function Rc(t){const{bucket:e}=t,a=await this.fetchBucket(e,"DELETE",{workflow:""},{});return a.data||(a.data={}),a}async function Ac(t){const{Name:e,AccountId:a,VpcId:n,Subnets:o,SecurityGroupId:i}=t;return await this.fetch("PUT","/apap",{name:e},{"x-tos-account-id":a},Ki({Name:e,VpcId:n,Subnets:o,SecurityGroupId:i}))}async function Dc(t){const{AccountId:e,...a}=t;return await this.fetch("GET","/apap",Ki(a),{"x-tos-account-id":e})}async function Oc(t){const{AccountId:e}=t;return await this.fetch("GET","/apap/az",{},{"x-tos-account-id":e})}async function Mc(t){const{AccountId:e}=t;return await this.fetch("GET","/apap/endpoint",{},{"x-tos-account-id":e})}!function(t){t.BasicInfoTemplate="basic_info_template",t.ImageSemanticTemplate="image_semantic_template"}(qi||(qi={})),function(t){t.INDEXING="Indexing",t.DONE="Done",t.FAILED="Failed"}($i||($i={})),function(t){t.NOT="not",t.OR="or",t.AND="and",t.LT="lt",t.LTE="lte",t.GT="gt",t.GTE="gte",t.EQ="eq",t.EXIST="exist",t.PREFIX="prefix",t.MATCH_PHRASE="match-phrase"}(Vi||(Vi={})),function(t){t.MIN="min",t.MAX="max",t.AVERAGE="average",t.SUM="sum",t.COUNT="count",t.DISTINCT="distinct",t.GROUP="group"}(Hi||(Hi={})),function(t){t.TEXT="text",t.IMAGE="image"}(Wi||(Wi={}));class _c extends Xe{constructor(...t){super(...t),this.createBucket=oa,this.headBucket=ca,this.doesBucketExist=sa,this.deleteBucket=ia,this.listBuckets=na,this.getBucketLocation=Ka,this.getBucketInfo=ua,this.putBucketStorageClass=ra,this.getBucketAcl=pa,this.putBucketAcl=la,this.putBucketHttpsConfig=da,this.getBucketHttpsConfig=ha,this.getBucketPolicy=ja,this.putBucketPolicy=_a,this.deleteBucketPolicy=Na,this.getBucketVersioning=La,this.putBucketVersioning=Ua,this.getBucketCORS=qa,this.putBucketCORS=$a,this.deleteBucketCORS=Va,this.putBucketLifecycle=Ha,this.getBucketLifecycle=Wa,this.deleteBucketLifecycle=Ja,this.putBucketEncryption=Qa,this.getBucketEncryption=Xa,this.deleteBucketEncryption=Ya,this.putBucketMirrorBack=Za,this.getBucketMirrorBack=tn,this.deleteBucketMirrorBack=en,this.putBucketReplication=cn,this.getBucketReplication=sn,this.deleteBucketReplication=rn,this.putBucketWebsite=un,this.getBucketWebsite=ln,this.deleteBucketWebsite=pn,this.putBucketNotification=dn,this.getBucketNotification=hn,this.putBucketCustomDomain=fn,this.getBucketCustomDomain=mn,this.deleteBucketCustomDomain=yn,this.putBucketRealTimeLog=gn,this.getBucketRealTimeLog=xn,this.deleteBucketRealTimeLog=kn,this.getBucketInventory=Bn,this.listBucketInventory=Pn,this.putBucketInventory=Rn,this.deleteBucketInventory=In,this.putBucketTagging=Nn,this.getBucketTagging=Ln,this.deleteBucketTagging=Un,this.putBucketPayByTraffic=zn,this.getBucketPayByTraffic=Fn,this.getBucketImageStyle=$n,this.getBucketImageStyleList=Kn,this.getBucketImageStyleListByName=qn,this.getImageStyleBriefInfo=Gn,this.deleteBucketImageStyle=Hn,this.putBucketImageStyle=Vn,this.putBucketImageStyleSeparator=Qn,this.putBucketImageProtect=Wn,this.getBucketImageProtect=Jn,this.getBucketImageStyleSeparator=Xn,this.putBucketRename=Zn,this.getBucketRename=to,this.deleteBucketRename=eo,this.putBucketTransferAcceleration=fo,this.getBucketTransferAcceleration=mo,this.copyObject=Me,this.resumableCopyObject=je,this.deleteObject=va,this.deleteMultiObjects=Sa,this.getObject=Le,this.getObjectV2=ze,this.getObjectToFile=Fe,this.getObjectAcl=Ea,this.headObject=De,this.doesObjectExist=Ta,this.appendObject=Ia,this.listObjects=Ye,this.renameObject=wa,this.fetchObject=ga,this.putFetchTask=xa,this.getFetchTask=ka,this.listObjectsType2=ta,this.listObjectVersions=Ze,this.putObject=fa,this.putObjectFromFile=ya,this.putObjectAcl=Ca,this.setObjectMeta=Ra,this.createMultipartUpload=rt,this.uploadPart=qt,this.uploadPartFromFile=$t,this.completeMultipartUpload=Vt,this.abortMultipartUpload=Ba,this.uploadPartCopy=Oe,this.listMultipartUploads=Pa,this.listParts=lt,this.downloadFile=qe,this.putObjectTagging=an,this.getObjectTagging=nn,this.deleteObjectTagging=on,this.listJobs=Dn,this.createJob=An,this.deleteJob=_n,this.describeJob=jn,this.updateJobStatus=Mn,this.updateJobPriority=On,this.restoreObject=ao,this.uploadFile=Qt,this.getPreSignedUrl=ba,this.calculatePostSignature=Aa,this.preSignedPostSignature=Aa,this.preSignedPolicyURL=za,this.getBucketIntelligenttiering=Yn,this.listStorageLens=no,this.deleteStorageLens=oo,this.getStorageLens=io,this.putStorageLens=co,this.putBucketNotificationType2=so,this.getBucketNotificationType2=ro,this.putSymlink=uo,this.getSymlink=po,this.putBucketAccessMonitor=yo,this.getBucketAccessMonitor=go,this.putQosPolicy=ko,this.getQosPolicy=xo,this.deleteQosPolicy=bo,this.createMultiRegionAccessPoint=To,this.getMultiRegionAccessPoint=vo,this.listMultiRegionAccessPoints=wo,this.getMultiRegionAccessPointRoutes=So,this.deleteMultiRegionAccessPoint=Eo,this.submitMultiRegionAccessPointRoutes=Co,this.bindAcceleratorWithMultiRegionAccessPoint=Bo,this.unbindAcceleratorWithMultiRegionAccessPoint=Po,this.listBindAccessPointForMultiRegionAccelerator=Io,this.putMultiRegionAccessPointMirrorBack=Jo,this.getMultiRegionAccessPointMirrorBack=Qo,this.deleteMultiRegionAccessPointMirrorBack=Xo,this.putMultiRegionAccessPointPolicy=Si,this.getMultiRegionAccessPointPolicy=Ei,this.deleteMultiRegionAccessPointPolicy=Ci,this.putAccessPointPolicy=Ti,this.getAccessPointPolicy=vi,this.deleteAccessPointPolicy=wi,this.createAccessPoint=Ro,this.getAccessPoint=Ao,this.listAccessPoints=Do,this.deleteAccessPoint=Oo,this.bindAcceleratorWithAccessPoint=Mo,this.unbindAcceleratorWithAccessPoint=_o,this.listBindAccessPointForAccelerator=jo,this.listAcceleratorAzs=Fo,this.putAccelerator=No,this.getAccelerator=Lo,this.listAccelerators=Uo,this.deleteAccelerator=zo,this.listBindAcceleratorForAccessPoint=Wo,this.putAcceleratorPrefetchJob=Go,this.getAcceleratorPrefetchJob=Ko,this.deleteAcceleratorPrefetchJob=qo,this.listAcceleratorPrefetchJobs=$o,this.listAcceleratorPrefetchJobRecords=Vo,this.getAcceleratorCapacityQuota=Ho,this.putBucketPrivateM3U8=Yo,this.getBucketPrivateM3U8=Zo,this.putBucketBlindWatermark=ti,this.getBucketBlindWatermark=ei,this.putBucketTrash=ai,this.getBucketTrash=ni,this.putBucketObjectLockConfiguration=oi,this.getBucketObjectLockConfiguration=ii,this.putObjectRetention=ci,this.getObjectRetention=si,this.putBucketCdnNotification=ri,this.getBucketCdnNotification=ui,this.deleteBucketCdnNotification=li,this.putBucketWorkflow=pi,this.getBucketWorkflow=di,this.deleteBucketWorkflow=hi,this.getBucketWorkflowExecution=fi,this.listBucketWorkflowExecution=mi,this.putConvertWorkflow=Pc,this.getConvertWorkflow=Ic,this.deleteConvertWorkflow=Rc,this.putBucketAudit=Pi,this.getBucketAudit=Bi,this.listBucketAuditJob=Ii,this.getBucketAuditJob=Ri,this.postBucketAuditJob=Ai,this.listBucketAuditBizType=Di,this.postBucketIncrementAudit=Oi,this.listBucketIncrementAudits=Mi,this.getBucketIncrementAudit=_i,this.deleteBucketIncrementAudit=ji,this.createFileCompress=yi,this.createFileUncompress=gi,this.createBucketAudioConvert=Ui,this.getAudioConvertJob=bc,this.createAudioConvertJob=kc,this.listBucketJob=Ni,this.getBucketJob=Li,this.putBucketLogging=ki,this.getBucketLogging=xi,this.deleteBucketLogging=bi,this.getObjectAITag=zi,this.putBucketRequestPayment=Fi,this.getBucketRequestPayment=Gi,this.createDataset=Ji,this.deleteDataset=Xi,this.listDataset=Yi,this.getDataset=Qi,this.createDatasetBinding=Zi,this.deleteDatasetBinding=tc,this.listDatasetBindings=ac,this.getDatasetBinding=ec,this.datasetSimpleQuery=nc,this.listTemplates=Tc,this.datasetSemanticQuery=oc,this.putBucketDataProcessTemplate=ic,this.putAudioConvertTemplate=uc,this.getBucketDataProcessTemplate=sc,this.deleteBucketDataProcessTemplate=rc,this.listBucketDataProcessTemplates=cc,this.getAudioConvertTemplate=lc,this.deleteAudioConvertTemplate=dc,this.listAudioConvertTemplates=pc,this.putVideoConvertTemplate=hc,this.getVideoConvertTemplate=fc,this.deleteVideoConvertTemplate=mc,this.listVideoConvertTemplates=yc,this.createVideoConvertJob=gc,this.getVideoConvertJob=xc,this.createBucketDataRedundancyTransition=vc,this.getBucketDataRedundancyTransition=wc,this.listBucketDataRedundancyTransition=Ec,this.deleteBucketDataRedundancyTransition=Sc,this.listUserDataRedundancyTransition=Bc,this.getBucketTransitionEstimatedRemainingTime=Cc,this.putAnyPrivateAccessPoint=Ac,this.listAnyPrivateAccessPoints=Dc,this.listAnyPrivateAccessPointSupportAz=Oc,this.listAnyPrivateAccessPointEndpoints=Mc}}async function jc(t){const{vectorBucketName:e}=t,a=await this.fetchVectors("POST","/CreateVectorBucket",{},{},{vectorBucketName:e});return a.data={},a}async function Nc(t){const{prefix:e,nextToken:a,maxResults:n,projectName:o}=t,i={};return o&&(i["x-tos-project-name"]=o),this.fetchVectors("POST","/ListVectorBuckets",{},i,{prefix:e,nextToken:a,maxResults:n})}async function Lc(t){const{accountID:e}=t,a={vectorBucketName:t.vectorBucketName};return await this.fetchVectors("POST","/GetVectorBucket",{},{},a,{bucket:t.vectorBucketName,accountId:e})}async function Uc(t){const{vectorBucketName:e,accountID:a}=t,n={vectorBucketName:t.vectorBucketName},o=await this.fetchVectors("POST","/DeleteVectorBucket",{},{},n,{bucket:e,accountId:a});return o.data={},o}async function zc(t){const e={vectorBucketName:t.vectorBucketName,policy:t.policy},a=await this.fetchVectors("POST","/PutVectorBucketPolicy",{},{},e,{bucket:t.vectorBucketName,accountId:t.accountID});return a.data={},a}async function Fc(t){const{vectorBucketName:e,accountId:a}=t,n={vectorBucketName:e};return await this.fetchVectors("POST","/GetVectorBucketPolicy",{},{},n,{accountId:a,bucket:e})}async function Gc(t){const e={vectorBucketName:t.vectorBucketName},a=await this.fetchVectors("POST","/DeleteVectorBucketPolicy",{},{},e,{bucket:t.vectorBucketName,accountId:t.accountID});return a.data={},a}async function Kc(t){const{vectorBucketName:e,accountID:a}=t,n={dataType:t.dataType,dimension:t.dimension,distanceMetric:t.distanceMetric,indexName:t.indexName,metadataConfiguration:t.metadataConfiguration,vectorBucketName:t.vectorBucketName};return await this.fetchVectors("POST","/CreateIndex",{},{},n,{bucket:e,accountId:a})}async function qc(t){const{vectorBucketName:e,accountID:a}=t,n={indexName:t.indexName,vectorBucketName:t.vectorBucketName},o=await this.fetchVectors("POST","/DeleteIndex",{},{},n,{bucket:e,accountId:a});return o.data={},o}async function $c(t){const{vectorBucketName:e,accountID:a}=t,n={vectorBucketName:t.vectorBucketName,maxResults:t.maxResults,nextToken:t.nextToken,prefix:t.prefix};return await this.fetchVectors("POST","/ListIndexes",{},{},n,{bucket:e,accountId:a})}async function Vc(t){const e={indexName:t.indexName,vectorBucketName:t.vectorBucketName};return await this.fetchVectors("POST","/GetIndex",{},{},e,{accountId:t.accountID,bucket:t.vectorBucketName})}async function Hc(t){const{vectorBucketName:e,accountID:a}=t,n={indexName:t.indexName,vectorBucketName:t.vectorBucketName,vectors:t.vectors};return await this.fetchVectors("POST","/PutVectors",{},{},n,{bucket:e,accountId:a})}async function Wc(t){const{vectorBucketName:e,accountID:a}=t,n={indexName:t.indexName,maxResults:t.maxResults,nextToken:t.nextToken,returnData:t.returnData,returnMetadata:t.returnMetadata,vectorBucketName:t.vectorBucketName};return await this.fetchVectors("POST","/ListVectors",{},{},n,{bucket:e,accountId:a})}async function Jc(t){const{vectorBucketName:e,accountID:a}=t,n={indexName:t.indexName,keys:t.keys,returnData:t.returnData,returnMetadata:t.returnMetadata,vectorBucketName:t.vectorBucketName};return await this.fetchVectors("POST","/GetVectors",{},{},n,{bucket:e,accountId:a})}async function Qc(t){const{vectorBucketName:e,accountID:a}=t,n={indexName:t.indexName,keys:t.keys,vectorBucketName:t.vectorBucketName},o=await this.fetchVectors("POST","/DeleteVectors",{},{},n,{bucket:e,accountId:a});return o.data={},o}async function Xc(t){const{vectorBucketName:e,accountID:a}=t,n={vectorBucketName:t.vectorBucketName,indexName:t.indexName,returnDistance:t.returnDistance,returnMetadata:t.returnMetadata,topK:t.topK,queryVector:t.queryVector,filter:t.filter};return await this.fetchVectors("POST","/QueryVectors",{},{},n,{bucket:e,accountId:a})}const Yc=a.CancelToken;class Zc extends _c{}Zc.TosServerError=v,Zc.isCancel=V,Zc.CancelError=S,Zc.TosServerCode=exports.TosServerCode,Zc.TosClientError=w,Zc.CancelToken=Yc,Zc.ACLType=exports.ACLType,Zc.StorageClassType=exports.StorageClassType,Zc.MetadataDirectiveType=exports.MetadataDirectiveType,Zc.AzRedundancyType=exports.AzRedundancyType,Zc.PermissionType=exports.PermissionType,Zc.GranteeType=exports.GranteeType,Zc.CannedType=exports.CannedType,Zc.HttpMethodType=exports.HttpMethodType,Zc.LifecycleStatusType=exports.LifecycleStatusType,Zc.StatusType=exports.StatusType,Zc.RedirectType=exports.RedirectType,Zc.StorageClassInheritDirectiveType=exports.StorageClassInheritDirectiveType,Zc.TierType=exports.TierType,Zc.FileUncompressPrefixReplaced=exports.FileUncompressPrefixReplaced,Zc.FileCompressFlatten=exports.FileCompressFlatten,Zc.VersioningStatusType=exports.VersioningStatusType,Zc.createDefaultRateLimiter=Tt,Zc.DataTransferType=exports.DataTransferType,Zc.UploadEventType=exports.UploadEventType,Zc.DownloadEventType=exports.DownloadEventType,Zc.ResumableCopyEventType=exports.ResumableCopyEventType,Zc.ReplicationStatusType=exports.ReplicationStatusType,Zc.AccessPointStatusType=exports.AccessPointStatusType,Zc.AccessPointStatus=exports.AccessPointStatus,Zc.AcceleratorPrefetchJobStatus=exports.AcceleratorPrefetchJobStatus,Zc.TransferAccelerationStatusType=exports.TransferAccelerationStatusType,Zc.MRAPMirrorBackRedirectPolicyType=exports.MRAPMirrorBackRedirectPolicyType,Zc.WorkflowExecutionStateType=exports.WorkflowExecutionStateType,Zc.ShareLinkClient=aa,Zc.AuditJobStateType=exports.AuditJobStateType,Zc.AuditScanType=exports.AuditScanType,Zc.AuditType=exports.AuditType,Zc.CallbackTriggerModeType=exports.CallbackTriggerModeType,Zc.FreezeModeType=exports.FreezeModeType,Zc.TemplateTagType=exports.TemplateTagType,Zc.AudioContainerFormatType=exports.AudioContainerFormatType,Zc.SampleFormatType=exports.SampleFormatType,exports.CancelError=S,exports.CancelToken=Yc,exports.ShareLinkClient=aa,exports.TOS=Zc,exports.TosClient=Zc,exports.TosClientError=w,exports.TosServerError=v,exports.TosVectorsClient=class extends Xe{constructor(t){super(t),this.serviceName="tosvectors",this.createVectorBucket=jc,this.listVectorBuckets=Nc,this.getVectorBucket=Lc,this.deleteVectorBucket=Uc,this.putVectorBucketPolicy=zc,this.getVectorBucketPolicy=Fc,this.deleteVectorBucketPolicy=Gc,this.createIndex=Kc,this.deleteIndex=qc,this.getIndex=Vc,this.listIndexes=$c,this.putVectors=Hc,this.listVectors=Wc,this.getVectors=Jc,this.deleteVectors=Qc,this.queryVectors=Xc}async fetchVectors(t,e,a,n,o,i){return void 0!==(null==i?void 0:i.bucket)&&(t=>{if(t){if(t.length<3||t.length>32)throw new w("invalid vector bucket name, the length must be [3, 32]");if(!/^([a-z]|-|\d)+$/.test(t))throw new w("invalid vector bucket name, the character set is illegal");if(/^-/.test(t)||/-$/.test(t))throw new w("invalid vector bucket name, the vector bucket name can be neither starting with '-' nor ending with '-'")}})(null==i?void 0:i.bucket),void 0!==(null==i?void 0:i.accountId)&&(t=>{if(""===t)throw new w("invalid account id, the account id must be non-empty");if(!/^\d+$/.test(t))throw new w("invalid account id, the account id must be a number")})(null==i?void 0:i.accountId),this.fetch(t,e,a,n,o,{serviceName:this.serviceName,subdomainBucket:null!=i&&i.accountId?`${null==i?void 0:i.bucket}-${null==i?void 0:i.accountId}`:void 0})}},exports.createDefaultRateLimiter=Tt,exports.default=Zc,exports.isCancel=V;
//# sourceMappingURL=tos.cjs.production.min.js.map
